<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="FlareBall&#39;s Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="FlareBall&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="FlareBall">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>FlareBall's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">FlareBall's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/03/leetcode-%E9%9D%A2%E8%AF%95%E7%BB%8F%E5%85%B8150%E9%A2%98-88-%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="FlareBall">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlareBall's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/11/03/leetcode-%E9%9D%A2%E8%AF%95%E7%BB%8F%E5%85%B8150%E9%A2%98-88-%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84/" class="post-title-link" itemprop="url">88.åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-11-03 13:32:00 / Modified: 14:49:45" itemprop="dateCreated datePublished" datetime="2025-11-03T13:32:00+08:00">2025-11-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leetcode/" itemprop="url" rel="index"><span itemprop="name">leetcode</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leetcode/%E9%9D%A2%E8%AF%95%E7%BB%8F%E5%85%B8150%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">é¢è¯•ç»å…¸150é¢˜</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="åŒæŒ‡é’ˆ"><a href="#åŒæŒ‡é’ˆ" class="headerlink" title="åŒæŒ‡é’ˆ"></a>åŒæŒ‡é’ˆ</h1><p>æ—¶é—´å¤æ‚åº¦ $O(m+n)$</p>
<p>ç©ºé—´å¤æ‚åº¦ $O(1)$</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span> m, <span class="type">int</span>[] nums2, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">p1</span> <span class="operator">=</span> m - <span class="number">1</span>, p2 = n - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> m + n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x1</span> <span class="operator">=</span> p1 &gt;= <span class="number">0</span> ? nums1[p1] : Integer.MIN_VALUE;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x2</span> <span class="operator">=</span> p2 &gt;= <span class="number">0</span> ? nums2[p2] : Integer.MIN_VALUE;</span><br><span class="line">            <span class="keyword">if</span>(x1 &gt; x2)&#123;</span><br><span class="line">                nums1[i] = x1;</span><br><span class="line">                p1--;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                nums1[i] = x2;</span><br><span class="line">                p2--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/03/leetcode-%E9%9D%A2%E8%AF%95%E7%BB%8F%E5%85%B8150%E9%A2%98-80-%E5%88%A0%E9%99%A4%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9%E2%85%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="FlareBall">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlareBall's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/11/03/leetcode-%E9%9D%A2%E8%AF%95%E7%BB%8F%E5%85%B8150%E9%A2%98-80-%E5%88%A0%E9%99%A4%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9%E2%85%A1/" class="post-title-link" itemprop="url">80.åˆ é™¤æœ‰åºæ•°ç»„çš„é‡å¤é¡¹â…¡</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-11-03 13:20:00 / Modified: 14:49:51" itemprop="dateCreated datePublished" datetime="2025-11-03T13:20:00+08:00">2025-11-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leetcode/" itemprop="url" rel="index"><span itemprop="name">leetcode</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leetcode/%E9%9D%A2%E8%AF%95%E7%BB%8F%E5%85%B8150%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">é¢è¯•ç»å…¸150é¢˜</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="åŒæŒ‡é’ˆ"><a href="#åŒæŒ‡é’ˆ" class="headerlink" title="åŒæŒ‡é’ˆ"></a>åŒæŒ‡é’ˆ</h1><p>æŠŠæ–°æ•°ç»„æƒ³è±¡æˆä¸€ä¸ªæ ˆï¼Œç”¨ä¸€ä¸ªæŒ‡é’ˆç»´æŠ¤æ ˆé¡¶ä½ç½®</p>
<p>æ—¶é—´å¤æ‚åº¦$O(n)$</p>
<p>ç©ºé—´å¤æ‚åº¦$O(1)$</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeDuplicates</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="keyword">if</span>(n &lt;= <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">2</span>, right = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">while</span>(right &lt; n)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[right] != nums[left - <span class="number">2</span>])&#123;<span class="comment">// left å§‹ç»ˆæŒ‡å‘æ–°æ•°ç»„çš„ç¬¬ä¸€ä¸ªå¯ç”¨ä½ç½®</span></span><br><span class="line">                nums[left] = nums[right];</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/11/03/leetcode-%E9%9D%A2%E8%AF%95%E7%BB%8F%E5%85%B8150%E9%A2%98-27-%E7%A7%BB%E9%99%A4%E5%85%83%E7%B4%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="FlareBall">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlareBall's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/11/03/leetcode-%E9%9D%A2%E8%AF%95%E7%BB%8F%E5%85%B8150%E9%A2%98-27-%E7%A7%BB%E9%99%A4%E5%85%83%E7%B4%A0/" class="post-title-link" itemprop="url">27.ç§»é™¤å…ƒç´ </a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-11-03 13:10:00 / Modified: 14:50:01" itemprop="dateCreated datePublished" datetime="2025-11-03T13:10:00+08:00">2025-11-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leetcode/" itemprop="url" rel="index"><span itemprop="name">leetcode</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leetcode/%E9%9D%A2%E8%AF%95%E7%BB%8F%E5%85%B8150%E9%A2%98/" itemprop="url" rel="index"><span itemprop="name">é¢è¯•ç»å…¸150é¢˜</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="åŒæŒ‡é’ˆ"><a href="#åŒæŒ‡é’ˆ" class="headerlink" title="åŒæŒ‡é’ˆ"></a>åŒæŒ‡é’ˆ</h1><p>æ—¶é—´å¤æ‚åº¦$O(n)$</p>
<p>ç©ºé—´å¤æ‚åº¦$O(1)$</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeElement</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(right &lt; nums.length)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[right] != val)&#123;</span><br><span class="line">                nums[left] = nums[right];</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/02/15/app%E9%83%A8%E7%BD%B2%EF%BC%88nfs%E4%B8%8Epvc%E4%BD%BF%E7%94%A8%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="FlareBall">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlareBall's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/15/app%E9%83%A8%E7%BD%B2%EF%BC%88nfs%E4%B8%8Epvc%E4%BD%BF%E7%94%A8%EF%BC%89/" class="post-title-link" itemprop="url">nfsä¸pvcä½¿ç”¨</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2025-02-15 13:10:00 / Modified: 13:50:05" itemprop="dateCreated datePublished" datetime="2025-02-15T13:10:00+08:00">2025-02-15</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>åœ¨k8sé›†ç¾¤ä¸Šåˆ©ç”¨nfså®ç°è·¨èŠ‚ç‚¹ç›®å½•å…±äº«ï¼Œéƒ¨ç½²ollamaå’Œnginxä½œä¸ºç»ƒä¹ ã€‚</p>
<p>ç¯å¢ƒä¸ºopeneuler22.03 sp3ï¼Œk8s1.23.6ï¼Œdockerä¸ºå®¹å™¨å¼•æ“ï¼Œflannelæä¾›é€šä¿¡æ”¯æŒ</p>
<p>ä¸€ä¸»ï¼ˆnode0-192.168.195.40ï¼‰äºŒä»(node1-192.168.195.41ã€node2-192.168.195.42)</p>
<p>æ‰€æœ‰æ•°æ®åˆ©ç”¨nfså®ç°å…±äº«ï¼ˆæ‰€æœ‰èŠ‚ç‚¹å‡éœ€å®‰è£…nfsæœåŠ¡ï¼‰ï¼Œæ•°æ®å­˜å‚¨åœ¨ä¸»èŠ‚ç‚¹&#x2F;opt&#x2F;k8s_store&#x2F;ç›®å½•ã€‚åˆ†åˆ«ä¸º&#x2F;opt&#x2F;k8s_store&#x2F;ollamaå’Œ&#x2F;opt&#x2F;k8s_store&#x2F;nginx</p>
<h2 id="nfså…±äº«"><a href="#nfså…±äº«" class="headerlink" title="nfså…±äº«"></a>nfså…±äº«</h2><p>å®‰è£…NFSæœåŠ¡ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> dnf install nfs-utils</span><br></pre></td></tr></table></figure>

<p>ç¼–è¾‘&#x2F;etc&#x2F;exportsæ–‡ä»¶ï¼Œæ·»åŠ å…±äº«ç›®å½•é…ç½®ï¼ˆå­˜å‚¨èŠ‚ç‚¹ï¼‰ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/k8s_store  *(rw,<span class="built_in">sync</span>,no_root_squash,no_subtree_check)</span><br></pre></td></tr></table></figure>

<p>è¿™ä¼šä½¿&#x2F;opt&#x2F;k8s_storeç›®å½•å¯¹æ‰€æœ‰èŠ‚ç‚¹ï¼ˆ*è¡¨ç¤ºæ‰€æœ‰ï¼‰å¯è¯»å†™ã€‚</p>
<p>é‡å¯NFSæœåŠ¡ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> systemctl restart nfs-server</span><br><span class="line"><span class="built_in">sudo</span> systemctl <span class="built_in">enable</span> nfs-server</span><br></pre></td></tr></table></figure>



<h1 id="ollamaéƒ¨ç½²"><a href="#ollamaéƒ¨ç½²" class="headerlink" title="ollamaéƒ¨ç½²"></a>ollamaéƒ¨ç½²</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ollama]# <span class="built_in">ls</span></span><br><span class="line">deployment.yaml  pvc.yaml  pv.yaml  service.yaml</span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶pv.yaml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ollama]# <span class="built_in">cat</span> pv.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolume</span><br><span class="line">metadata:</span><br><span class="line">  name: ollama-pv</span><br><span class="line">spec:</span><br><span class="line">  capacity:</span><br><span class="line">    storage: 8Gi</span><br><span class="line">  volumeMode: Filesystem</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteMany  <span class="comment"># ä½¿ç”¨ReadWriteManyï¼Œæ”¯æŒå¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</span></span><br><span class="line">  persistentVolumeReclaimPolicy: Retain</span><br><span class="line">  nfs:</span><br><span class="line">    path: /opt/k8s_store/ollama  <span class="comment"># å…±äº«ç›®å½•</span></span><br><span class="line">    server: node0  <span class="comment"># NFSæœåŠ¡å™¨åœ°å€</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶pvc.yaml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ollama]# <span class="built_in">cat</span> pvc.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: ollama-pvc</span><br><span class="line">spec:</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteMany  <span class="comment"># å¯¹åº”ä¿®æ”¹åçš„PVé…ç½®</span></span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 8Gi</span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶deployment.yaml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ollama]# <span class="built_in">cat</span> deployment.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: ollama-deployment  <span class="comment"># Deployment åç§°</span></span><br><span class="line">spec:</span><br><span class="line">  replicas: 1  <span class="comment"># å‰¯æœ¬æ•°ï¼ˆå¯ä»¥æ ¹æ®éœ€æ±‚è°ƒæ•´å‰¯æœ¬æ•°ï¼‰</span></span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: ollama  <span class="comment"># åŒ¹é…æ ‡ç­¾ï¼ŒPod ä¼šä»¥æ­¤æ ‡ç­¾è¿›è¡Œé€‰æ‹©</span></span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: ollama  <span class="comment"># Pod æ ‡ç­¾</span></span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: ollama  <span class="comment"># å®¹å™¨åç§°</span></span><br><span class="line">          image: ollama/ollama:latest  <span class="comment"># ä½¿ç”¨çš„é•œåƒ</span></span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 11434  <span class="comment"># å®¹å™¨ç«¯å£æ˜ å°„</span></span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: ollama-storage  <span class="comment"># ä½¿ç”¨ PVC æŒ‚è½½å·</span></span><br><span class="line">              mountPath: /root/.ollama  <span class="comment"># æŒ‚è½½è·¯å¾„ï¼Œå®¹å™¨å†…çš„è·¯å¾„</span></span><br><span class="line">      restartPolicy: Always  <span class="comment"># ç¡®ä¿å®¹å™¨å¤±è´¥æ—¶é‡å¯</span></span><br><span class="line">      volumes:</span><br><span class="line">        - name: ollama-storage</span><br><span class="line">          persistentVolumeClaim:</span><br><span class="line">            claimName: ollama-pvc  <span class="comment"># ç»‘å®šçš„ PVC åç§°</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶service.yaml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ollama]# <span class="built_in">cat</span> service.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: ollama-service  <span class="comment"># Service åç§°</span></span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: ollama  <span class="comment"># åŒ¹é…çš„æ ‡ç­¾ï¼Œç¡®ä¿è¯·æ±‚è¢«è½¬å‘åˆ° Deployment å¯¹åº”çš„ Pod</span></span><br><span class="line">  ports:</span><br><span class="line">    - protocol: TCP</span><br><span class="line">      port: 11434  <span class="comment"># Service ç«¯å£</span></span><br><span class="line">      targetPort: 11434  <span class="comment"># å®¹å™¨å†…éƒ¨ç«¯å£</span></span><br><span class="line">  <span class="built_in">type</span>: NodePort  <span class="comment"># è®©å¤–éƒ¨èƒ½å¤Ÿé€šè¿‡ NodePort è®¿é—®è¯¥æœåŠ¡</span></span><br></pre></td></tr></table></figure>



<p>(å®é™…ä¸Šåœ¨æœ¬ç¤ºä¾‹ä¸­å¹¶æœªè¿›ä¸€æ­¥ä½¿ç”¨æ­¤å¤„å¼€æ”¾çš„ç«¯å£)ï¼Œè¿™é‡Œå¯ä»¥è¿›ä¸€æ­¥ä¸difyç­‰å·¥å…·è”åŠ¨ï¼Œå®ç°å¤–éƒ¨apiè®¿é—®æœåŠ¡ã€‚å¯ä»¥æŸ¥é˜…</p>
<p><a target="_blank" rel="noopener" href="https://docs.dify.ai/learn-more/use-cases/private-ai-ollama-deepseek-dify">Private Deployment of Ollama + DeepSeek + Dify: Build Your Own AI Assistant | Dify</a></p>
<p>åˆ©å¦‚ä¸‹å‘½ä»¤è¿›è¡Œéƒ¨ç½²</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f pv.yaml</span><br><span class="line">kubectl apply -f pvc.yaml</span><br><span class="line">kubectl apply -f deployment.yaml</span><br></pre></td></tr></table></figure>



<p>æœ€ç»ˆç»“æœä¸º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ollama]# kubectl get pods</span><br><span class="line">NAME                                 READY   STATUS        RESTARTS      AGE</span><br><span class="line">k8s-nginx-6d779d947c-mvj99           1/1     Running       2 (76m ago)   46d</span><br><span class="line">k8s-nginx-6d779d947c-qdkvh           1/1     Running       2 (76m ago)   46d</span><br><span class="line">k8s-nginx-6d779d947c-zh8zs           1/1     Running       2 (76m ago)   46d</span><br><span class="line">ollama-deployment-777b9bccb7-sj7wd   1/1     Running       0             3m18s</span><br><span class="line">[root@node0 ollama]#</span><br></pre></td></tr></table></figure>

<h1 id="ollamaè¯•ç”¨"><a href="#ollamaè¯•ç”¨" class="headerlink" title="ollamaè¯•ç”¨"></a>ollamaè¯•ç”¨</h1><p>æ­¤å¤„è¿›å…¥podå†…éƒ¨ï¼Œä¸‹è½½deepseekr1:1.5bå®Œæ•´éƒ¨ç½²ç»“æœ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ollama]# kubectl <span class="built_in">exec</span> -it ollama-deployment-777b9bccb7-sj7wd -- /bin/bash</span><br><span class="line">root@ollama-deployment-777b9bccb7-sj7wd:/# ollama run deepseek-r1:1.5b</span><br><span class="line">pulling manifest</span><br><span class="line">pulling aabd4debf0c8... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 1.1 GB</span><br><span class="line">pulling 369ca498f347... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  387 B</span><br><span class="line">pulling 6e4c38e1172f... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– 1.1 KB</span><br><span class="line">pulling f4d24e9138dd... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  148 B</span><br><span class="line">pulling a85fe2a2e58e... 100% â–•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  487 B</span><br><span class="line">verifying sha256 digest</span><br><span class="line">writing manifest</span><br><span class="line">success</span><br><span class="line">&gt;&gt;&gt; hi</span><br><span class="line">&lt;think&gt;</span><br><span class="line"></span><br><span class="line">&lt;/think&gt;</span><br><span class="line"></span><br><span class="line">Hello! How can I assist you today? ğŸ˜Š</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; wo are you</span><br><span class="line">&lt;think&gt;</span><br><span class="line"></span><br><span class="line">&lt;/think&gt;</span><br><span class="line"></span><br><span class="line">Hello! It seems like your message is a bit unclear. Could you please provide more context or clarify what you<span class="string">&#x27;re asking? I&#x27;</span>m here to <span class="built_in">help</span>! ğŸ˜Š</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; /bye</span><br><span class="line">root@ollama-deployment-777b9bccb7-sj7wd:/# <span class="built_in">exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[root@node0 ollama]# </span><br></pre></td></tr></table></figure>



<p>å¯ä»¥é¡ºåˆ©ä½¿ç”¨ï¼Œéƒ¨ç½²æˆåŠŸã€‚</p>
<h1 id="nginxæ­å»ºhtmlæœåŠ¡å™¨"><a href="#nginxæ­å»ºhtmlæœåŠ¡å™¨" class="headerlink" title="nginxæ­å»ºhtmlæœåŠ¡å™¨"></a>nginxæ­å»ºhtmlæœåŠ¡å™¨</h1><p>æ­¤å¤„å‡†å¤‡äº†wiresharkçš„æœ¬åœ°ç”¨æˆ·æ‰‹å†Œä½œä¸ºæœåŠ¡å†…å®¹ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WiresharkUser<span class="string">&#x27;sGuide.zip # å†…å«nå¤šhtmlæ–‡æ¡£</span></span><br></pre></td></tr></table></figure>

<p>è§£å‹åˆ°&#x2F;opt&#x2F;k8s_store&#x2F;nginx&#x2F;indexé‡Œé¢ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip <span class="string">&quot;WiresharkUser&#x27;sGuide.zip&quot;</span> -d /opt/k8s_store/nginx/index</span><br></pre></td></tr></table></figure>

<p>åœ¨å…±äº«ç›®å½•å†™ä¸€ä¸ªindex.htmlæ”¾åœ¨&#x2F;opt&#x2F;k8s_store&#x2F;nginx</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 nginx]# nano index.html</span><br><span class="line">[root@node0 nginx]# <span class="built_in">pwd</span></span><br><span class="line">/opt/k8s_store/nginx</span><br><span class="line"></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;en&quot;</span>&gt;</span><br><span class="line">&lt;<span class="built_in">head</span>&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;Index of Files&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        body &#123;</span><br><span class="line">            font-family: Arial, sans-serif;</span><br><span class="line">            margin: 20px;</span><br><span class="line">        &#125;</span><br><span class="line">        h1 &#123;</span><br><span class="line">            color: <span class="comment">#333;</span></span><br><span class="line">        &#125;</span><br><span class="line">        ul &#123;</span><br><span class="line">            list-style-type: none;</span><br><span class="line">            padding: 0;</span><br><span class="line">        &#125;</span><br><span class="line">        li &#123;</span><br><span class="line">            margin: 8px 0;</span><br><span class="line">        &#125;</span><br><span class="line">        a &#123;</span><br><span class="line">            text-decoration: none;</span><br><span class="line">            color: <span class="comment">#007bff;</span></span><br><span class="line">        &#125;</span><br><span class="line">        a:hover &#123;</span><br><span class="line">            text-decoration: underline;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Index of Files&lt;/h1&gt;</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">        &lt;li&gt;&lt;a href=<span class="string">&quot;index/index.html&quot;</span>&gt;Click Here to <span class="string">&#x27;Wireshark Userâ€™s Guide&#x27;</span>&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">        &lt;!-- Add more links here as needed --&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>ç”¨åˆ°çš„é…ç½®æ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 nginx]# <span class="built_in">ls</span></span><br><span class="line">nginx-deployment.yaml  nginx-service.yaml  pvc.yaml  pv.yaml</span><br></pre></td></tr></table></figure>

<p>pv.yaml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 nginx]# <span class="built_in">cat</span> pv.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolume</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-pv</span><br><span class="line">spec:</span><br><span class="line">  capacity:</span><br><span class="line">    storage: 1Gi</span><br><span class="line">  volumeMode: Filesystem</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteMany  <span class="comment"># ä½¿ç”¨ReadWriteManyï¼Œæ”¯æŒå¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</span></span><br><span class="line">  persistentVolumeReclaimPolicy: Retain</span><br><span class="line">  nfs:</span><br><span class="line">    path: /opt/k8s_store/nginx  <span class="comment"># å…±äº«ç›®å½•</span></span><br><span class="line">    server: node0  <span class="comment"># NFSæœåŠ¡å™¨åœ°å€</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>pvc.yaml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 nginx]# <span class="built_in">cat</span> pvc.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: PersistentVolumeClaim</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-pvc</span><br><span class="line">spec:</span><br><span class="line">  accessModes:</span><br><span class="line">    - ReadWriteMany  <span class="comment"># å¯¹åº”ä¿®æ”¹åçš„PVé…ç½®</span></span><br><span class="line">  resources:</span><br><span class="line">    requests:</span><br><span class="line">      storage: 1Gi</span><br></pre></td></tr></table></figure>



<p>nginx-deployment.yaml </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 nginx]# <span class="built_in">cat</span> nginx-deployment.yaml </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: k8s-nginx</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: k8s-nginx</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: k8s-nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">        - name: nginx</span><br><span class="line">          image: nginx:latest</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 80</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: nginx-storage</span><br><span class="line">              mountPath: /usr/share/nginx/html  <span class="comment"># NFS å…±äº«ç›®å½•æŒ‚è½½åˆ° Nginx çš„é»˜è®¤ç½‘é¡µç›®å½•</span></span><br><span class="line">      volumes:</span><br><span class="line">        - name: nginx-storage</span><br><span class="line">          persistentVolumeClaim:</span><br><span class="line">            claimName: nginx-pvc  <span class="comment"># ç»‘å®šçš„ PVC åç§°</span></span><br></pre></td></tr></table></figure>



<p>nginx-service.yaml</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 nginx]# <span class="built_in">cat</span> nginx-service.yaml </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-service  <span class="comment"># æœåŠ¡åç§°</span></span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: k8s-nginx  <span class="comment"># é€‰æ‹©æ ‡ç­¾ï¼Œç¡®ä¿å°†æµé‡è½¬å‘åˆ°å¯¹åº”çš„ Pod</span></span><br><span class="line">  ports:</span><br><span class="line">    - protocol: TCP</span><br><span class="line">      port: 80  <span class="comment"># æœåŠ¡ç«¯å£</span></span><br><span class="line">      targetPort: 80  <span class="comment"># å®¹å™¨å†…éƒ¨ç«¯å£</span></span><br><span class="line">  <span class="built_in">type</span>: NodePort  <span class="comment"># ä½¿ç”¨ NodePort ç±»å‹æ¥æš´éœ²æœåŠ¡</span></span><br><span class="line"></span><br><span class="line">[root@node0 nginx]#</span><br></pre></td></tr></table></figure>

<p>åº”ç”¨å³å¯</p>
<h1 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h1><h2 id="æ›´æ”¹å…±äº«ç›®å½•æƒé™"><a href="#æ›´æ”¹å…±äº«ç›®å½•æƒé™" class="headerlink" title="æ›´æ”¹å…±äº«ç›®å½•æƒé™"></a>æ›´æ”¹å…±äº«ç›®å½•æƒé™</h2><p>æ‰€æœ‰äººå¯ä»¥è®¿é—®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 nginx]# <span class="built_in">sudo</span> <span class="built_in">chmod</span> -R 777 /opt/k8s_store</span><br></pre></td></tr></table></figure>



<h2 id="pvc-pvæ›´æ–°"><a href="#pvc-pvæ›´æ–°" class="headerlink" title="pvc&#x2F;pvæ›´æ–°"></a>pvc&#x2F;pvæ›´æ–°</h2><p>å¦‚æœä¹‹å‰éƒ¨ç½²æ–‡ä»¶æœ‰è¯¯è¦é‡æ–°éƒ¨ç½²ï¼Œå¯ä»¥ä½¿ç”¨åˆ é™¤åŸé…ç½®é‡æ–°éƒ¨ç½²</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤æ—§çš„pvcå’Œpvåˆ›å»ºæ–°çš„</span></span><br><span class="line">[root@node0 ollama]# vi pv.yaml</span><br><span class="line">[root@node0 ollama]# vi pvc.yaml</span><br><span class="line">[root@node0 ollama]# kubectl delete pvc ollama-pvc</span><br><span class="line">persistentvolumeclaim <span class="string">&quot;ollama-pvc&quot;</span> deleted</span><br><span class="line">[root@node0 ollama]# kubectl delete pv ollama-pv</span><br><span class="line">persistentvolume <span class="string">&quot;ollama-pv&quot;</span> deleted</span><br><span class="line">[root@node0 ollama]# kubectl apply -f pv.yaml</span><br><span class="line">persistentvolume/ollama-pv created</span><br><span class="line">[root@node0 ollama]# kubectl apply -f pvc.yaml</span><br><span class="line">persistentvolumeclaim/ollama-pvc created</span><br></pre></td></tr></table></figure>



<h2 id="pvcåˆ é™¤å¡ä½"><a href="#pvcåˆ é™¤å¡ä½" class="headerlink" title="pvcåˆ é™¤å¡ä½"></a>pvcåˆ é™¤å¡ä½</h2><p>æ˜¾ç¤º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ~]# kubectl get pvc ollama-pvc</span><br><span class="line">NAME         STATUS        VOLUME      CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">ollama-pvc   Terminating   ollama-pv   8Gi        RWO                           27m</span><br><span class="line">[root@node0 ~]# </span><br></pre></td></tr></table></figure>

<p>å½“PVCæ˜¾ç¤ºä¸ºTerminatingæ—¶ï¼Œé€šå¸¸æ„å‘³ç€Kubernetesæ­£åœ¨æ‰§è¡Œåˆ é™¤æ“ä½œï¼Œä½†æœªèƒ½å®Œå…¨å®Œæˆã€‚è¿™é€šå¸¸æ˜¯ç”±äºæŸäº›èµ„æºæ¸…ç†ä¸å®Œæ•´æˆ–åœ¨åˆ é™¤è¿‡ç¨‹ä¸­å‘ç”Ÿé˜»å¡ã€‚</p>
<p>æŸ¥çœ‹è¯¥PVCè¯¦ç»†ä¿¡æ¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl describe pvc ollama-pvc</span><br></pre></td></tr></table></figure>

<p>æ­¤å¤„æ˜¾ç¤º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ~]# kubectl describe pvc ollama-pvc</span><br><span class="line">Name:          ollama-pvc</span><br><span class="line">Namespace:     default</span><br><span class="line">StorageClass:  </span><br><span class="line">Status:        Terminating (lasts 2m16s)</span><br><span class="line">Volume:        ollama-pv</span><br><span class="line">Labels:        &lt;none&gt;</span><br><span class="line">Annotations:   pv.kubernetes.io/bind-completed: <span class="built_in">yes</span>     </span><br><span class="line">               pv.kubernetes.io/bound-by-controller: <span class="built_in">yes</span></span><br><span class="line">Finalizers:    [kubernetes.io/pvc-protection]</span><br><span class="line">Capacity:      8Gi</span><br><span class="line">Access Modes:  RWO</span><br><span class="line">VolumeMode:    Filesystem</span><br><span class="line">Used By:       ollama-deployment-777b9bccb7-wq6lh</span><br><span class="line">Events:        &lt;none&gt;</span><br><span class="line">[root@node0 ~]#</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œå®ƒæ­£å¤„äºFinalizersä¿æŠ¤æœºåˆ¶ä¸‹ã€‚Finalizers: [kubernetes.io&#x2F;pvc-protection]è¡¨ç¤ºKubernetesæ­£åœ¨ç¡®ä¿è¯¥PVCä¸ä¼šåœ¨è¢«ä½¿ç”¨æ—¶è¢«åˆ é™¤ã€‚</p>
<p>ç”±äºollama-deployment-777b9bccb7-wq6lhè¿™ä¸ªPodä»åœ¨ä½¿ç”¨è¯¥PVCï¼Œåˆ é™¤æ“ä½œæ²¡æœ‰å®Œæˆã€‚</p>
<p>è§£å†³æ–¹æ¡ˆä¸ºåˆ é™¤Pod</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod ollama-deployment-777b9bccb7-wq6lh</span><br></pre></td></tr></table></figure>

<p>è¿™æ—¶å€™pvcå³å¯åˆ é™¤</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥é€‰æ‹©å¼ºåˆ¶åˆ é™¤pvcï¼Œä¸è¿‡ä¸åšæ¨èï¼ˆæ­¤å¤„æœªä½¿ç”¨ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pvc ollama-pvc --force --grace-period=0</span><br></pre></td></tr></table></figure>



<h2 id="podè‡ªåŠ¨é‡å¯"><a href="#podè‡ªåŠ¨é‡å¯" class="headerlink" title="podè‡ªåŠ¨é‡å¯"></a>podè‡ªåŠ¨é‡å¯</h2><p>åˆšæ‰æ‰§è¡Œäº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete pod ollama-deployment-777b9bccb7-wq6lh</span><br></pre></td></tr></table></figure>

<p>ä½†ç”±äºä¹‹å‰éƒ¨ç½²ç”±Deploymentç®¡ç†ï¼ŒDeploymentä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°çš„Podæ¥æ›¿ä»£è¢«åˆ é™¤çš„Podã€‚</p>
<p>å¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ~]# kubectl get po</span><br><span class="line">NAME                                 READY   STATUS    RESTARTS      AGE</span><br><span class="line">k8s-nginx-6d779d947c-mvj99           1/1     Running   2 (59m ago)   46d</span><br><span class="line">k8s-nginx-6d779d947c-qdkvh           1/1     Running   2 (59m ago)   46d</span><br><span class="line">k8s-nginx-6d779d947c-zh8zs           1/1     Running   2 (59m ago)   46d</span><br><span class="line">ollama-deployment-777b9bccb7-nb9ct   0/1     Pending   0             10s</span><br><span class="line">[root@node0 ~]#</span><br></pre></td></tr></table></figure>

<p>é˜»æ­¢podè‡ªåŠ¨é‡å¯å¯ä»¥åˆ é™¤deployment</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete deployment ollama-deployment</span><br></pre></td></tr></table></figure>

<p>é‡æ–°æŸ¥çœ‹ï¼Œå‘ç°åˆ é™¤æˆåŠŸ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ollama]# kubectl get pods</span><br><span class="line">NAME                                 READY   STATUS        RESTARTS      AGE</span><br><span class="line">k8s-nginx-6d779d947c-mvj99           1/1     Running       2 (76m ago)   46d</span><br><span class="line">k8s-nginx-6d779d947c-qdkvh           1/1     Running       2 (76m ago)   46d</span><br><span class="line">k8s-nginx-6d779d947c-zh8zs           1/1     Running       2 (76m ago)   46d</span><br><span class="line">ollama-deployment-777b9bccb7-sj7wd   1/1     Running       0             3m18s</span><br><span class="line">[root@node0 ollama]</span><br></pre></td></tr></table></figure>

<h2 id="æ›´æ”¹å‰¯æœ¬æ•°"><a href="#æ›´æ”¹å‰¯æœ¬æ•°" class="headerlink" title="æ›´æ”¹å‰¯æœ¬æ•°"></a>æ›´æ”¹å‰¯æœ¬æ•°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale deployment k8s-nginx --replicas=1</span><br></pre></td></tr></table></figure>

<h2 id="scpä¼ è¾“"><a href="#scpä¼ è¾“" class="headerlink" title="scpä¼ è¾“"></a>scpä¼ è¾“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\<span class="built_in">dd</span>\Desktop&gt; scp <span class="string">&#x27;.\WiresharkUser&#x27;</span><span class="string">&#x27;sGuide.zip&#x27;</span> root@192.168.195.40:/opt/k8s_store/nginx</span><br><span class="line"></span><br><span class="line">Authorized <span class="built_in">users</span> only. All activities may be monitored and reported.</span><br><span class="line">root@192.168.195.40<span class="string">&#x27;s password:</span></span><br><span class="line"><span class="string">WiresharkUser&#x27;</span>sGuide.zip                                                              100%   10MB 129.3MB/s   00:00</span><br><span class="line">PS C:\Users\<span class="built_in">dd</span>\Desktop&gt;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/12/04/prometheus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="FlareBall">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlareBall's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/12/04/prometheus/" class="post-title-link" itemprop="url">prometheusç›‘æ§dockerå’Œlinuxä¸»æœº</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-12-04 00:10:00 / Modified: 00:17:54" itemprop="dateCreated datePublished" datetime="2024-12-04T00:10:00+08:00">2024-12-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="prometheusç›‘æ§k8s"><a href="#prometheusç›‘æ§k8s" class="headerlink" title="prometheusç›‘æ§k8s"></a>prometheusç›‘æ§k8s</h1><h2 id="åˆè§prometheus"><a href="#åˆè§prometheus" class="headerlink" title="åˆè§prometheus"></a>åˆè§prometheus</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /opt/prometheus/config/prometheus.yml</span><br></pre></td></tr></table></figure>



<p>å¡«å…¥å¦‚ä¸‹å†…å®¹ä½œä¸ºé…ç½®ï¼ˆç›‘æ§è‡ªå·±ï¼‰</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;prometheus&quot;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&quot;localhost:9090&quot;</span>]  <span class="comment"># Prometheus ä¸»èŠ‚ç‚¹åœ°å€</span></span><br></pre></td></tr></table></figure>

<p>è¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name=prometheus -p 9090:9090 -v /opt/prometheus/config/prometheus.yml:/etc/prometheus/prometheus.yml prom/prometheus</span><br></pre></td></tr></table></figure>

<p>è¿è¡ŒæˆåŠŸåå¯ä»¥æµè§ˆå™¨è®¿é—®</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203192821670.png" alt="image-20241203192821670"></p>
<h2 id="nginxå®ä¾‹"><a href="#nginxå®ä¾‹" class="headerlink" title="nginxå®ä¾‹"></a>nginxå®ä¾‹</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name=mynginx -p 10080:80 nginx</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶å¯ä»¥åœ¨æµè§ˆå™¨è®¿é—®</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203193603780.png" alt="image-20241203193603780"></p>
<p>ä½¿ç”¨statsæŸ¥çœ‹æŸå®¹å™¨çŠ¶æ€</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 docker.service.d]# docker stats mynginx</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">[root@node0 docker.service.d]# docker stats --no-stream mynginx</span><br><span class="line">CONTAINER ID        NAME                CPU %               MEM USAGE / LIMIT     MEM %               NET I/O             BLOCK I/O           PIDS</span><br><span class="line">96ee9202c1c9        mynginx             0.00%               3.598MiB / 3.297GiB   0.11%               5.77kB / 4.89kB     0B / 16.4kB         5</span><br></pre></td></tr></table></figure>

<p>è¯´æ˜    â€“no-stream       Disable streaming stats and only pull the first result\</p>
<h2 id="ç»ˆç«¯å¤„ç†æ ¼å¼åŒ–æ–‡æœ¬"><a href="#ç»ˆç«¯å¤„ç†æ ¼å¼åŒ–æ–‡æœ¬" class="headerlink" title="ç»ˆç«¯å¤„ç†æ ¼å¼åŒ–æ–‡æœ¬"></a>ç»ˆç«¯å¤„ç†æ ¼å¼åŒ–æ–‡æœ¬</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stats --no-stream mynginx | awk <span class="string">&#x27;NR!=1&#123;print $3&#125;&#x27;</span></span><br></pre></td></tr></table></figure>


<p>è§£é‡Š<br>NRï¼šè¡¨ç¤ºå½“å‰å¤„ç†çš„è¡Œå·ã€‚NR !&#x3D; 1 ä»£è¡¨è·³è¿‡ç¬¬ä¸€è¡Œï¼ˆæ ‡é¢˜è¡Œï¼‰<br>print $3ï¼šè¡¨ç¤ºè¾“å‡ºæ¯è¡Œçš„ç¬¬ä¸‰åˆ—ï¼ˆå³ CPU ä½¿ç”¨ç™¾åˆ†æ¯”ï¼‰ã€‚</p>
<h2 id="awkä½¿ç”¨ï¼ˆæ’æ›²ï¼‰"><a href="#awkä½¿ç”¨ï¼ˆæ’æ›²ï¼‰" class="headerlink" title="awkä½¿ç”¨ï¼ˆæ’æ›²ï¼‰"></a>awkä½¿ç”¨ï¼ˆæ’æ›²ï¼‰</h2><p>awk æ˜¯ä¸€ç§å¼ºå¤§çš„æ–‡æœ¬å¤„ç†å·¥å…·ï¼Œé€šå¸¸ç”¨äºä»æ–‡æœ¬ä¸­æå–ã€å¤„ç†å’Œç”ŸæˆæŠ¥å‘Šã€‚å®ƒç‰¹åˆ«é€‚ç”¨äºå¤„ç†ç»“æ„åŒ–çš„æ–‡æœ¬æ•°æ®ï¼Œæ¯”å¦‚æ—¥å¿—æ–‡ä»¶ã€CSV æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ã€è¡¨æ ¼æ•°æ®ç­‰ã€‚å®ƒå¯ä»¥æŒ‰è¡Œå¤„ç†æ–‡æœ¬ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡åˆ†éš”ç¬¦ï¼ˆä¾‹å¦‚ç©ºæ ¼ã€é€—å·ç­‰ï¼‰æ¥å¤„ç†æ•°æ®ã€‚</p>
<p>awk åŸºæœ¬ç”¨é€”å’ŒåŠŸèƒ½</p>
<h3 id="æŒ‰åˆ—å¤„ç†æ•°æ®"><a href="#æŒ‰åˆ—å¤„ç†æ•°æ®" class="headerlink" title="æŒ‰åˆ—å¤„ç†æ•°æ®"></a>æŒ‰åˆ—å¤„ç†æ•°æ®</h3><p>awk å¯ä»¥è½»æ¾å¤„ç†æŒ‰ç©ºæ ¼æˆ–å…¶ä»–åˆ†éš”ç¬¦ï¼ˆä¾‹å¦‚é€—å·ï¼‰åˆ†éš”çš„æ–‡æœ¬ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œawk ä½¿ç”¨ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦ï¼ˆTabï¼‰ä½œä¸ºåˆ†éš”ç¬¦æ¥åˆ’åˆ†æ¯è¡Œæ•°æ®ï¼Œå¹¶é€šè¿‡ $1, $2, $3 ç­‰æ¥è®¿é—®æ¯ä¸€åˆ—ã€‚</p>
<p>ç¤ºä¾‹ï¼šä»ä¸€ä¸ªæ–‡ä»¶æˆ–å‘½ä»¤è¾“å‡ºä¸­æå–æ¯è¡Œçš„ç¬¬ä¸€åˆ—æ•°æ®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;apple 10\nbanana 20&quot;</span> | awk <span class="string">&#x27;&#123;print $1&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apple</span><br><span class="line">banana</span><br></pre></td></tr></table></figure>



<h3 id="æ“ä½œè¡Œå’Œåˆ—"><a href="#æ“ä½œè¡Œå’Œåˆ—" class="headerlink" title="æ“ä½œè¡Œå’Œåˆ—"></a>æ“ä½œè¡Œå’Œåˆ—</h3><p>åœ¨ awk ä¸­ä½¿ç”¨æ¡ä»¶è¯­å¥ã€å¾ªç¯ã€æ•°å­¦è¿ç®—ç­‰æ¥å¤„ç†æ–‡æœ¬ä¸­çš„æ•°æ®ã€‚</p>
<p>ç¤ºä¾‹ï¼šè®¡ç®—æ¯è¡Œç¬¬ä¸€åˆ—å’Œç¬¬äºŒåˆ—çš„å’Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;10 20\n30 40&quot;</span> | awk <span class="string">&#x27;&#123;print $1 + $2&#125;&#x27;</span></span><br></pre></td></tr></table></figure>


<p>è¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">30</span><br><span class="line">70</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨å­—æ®µåˆ†éš”ç¬¦ï¼ˆFSï¼‰"><a href="#ä½¿ç”¨å­—æ®µåˆ†éš”ç¬¦ï¼ˆFSï¼‰" class="headerlink" title="ä½¿ç”¨å­—æ®µåˆ†éš”ç¬¦ï¼ˆFSï¼‰"></a>ä½¿ç”¨å­—æ®µåˆ†éš”ç¬¦ï¼ˆFSï¼‰</h3><p>å¯ä»¥æŒ‡å®šè‡ªå®šä¹‰çš„å­—æ®µåˆ†éš”ç¬¦ã€‚ä¾‹å¦‚ï¼Œå½“æ•°æ®æ˜¯ CSV æ ¼å¼æ—¶ï¼Œåˆ†éš”ç¬¦æ˜¯é€—å·ã€‚</p>
<p>ç¤ºä¾‹ï¼šæŒ‡å®šé€—å·ä½œä¸ºåˆ†éš”ç¬¦æ¥å¤„ç† CSV æ•°æ®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;apple,10\nbanana,20&quot;</span> | awk -F <span class="string">&#x27;,&#x27;</span> <span class="string">&#x27;&#123;print $1&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apple</span><br><span class="line">banana</span><br></pre></td></tr></table></figure>



<h3 id="æ¨¡å¼åŒ¹é…å’Œæ¡ä»¶æ‰§è¡Œ"><a href="#æ¨¡å¼åŒ¹é…å’Œæ¡ä»¶æ‰§è¡Œ" class="headerlink" title="æ¨¡å¼åŒ¹é…å’Œæ¡ä»¶æ‰§è¡Œ"></a>æ¨¡å¼åŒ¹é…å’Œæ¡ä»¶æ‰§è¡Œ</h3><p>awk å…è®¸æ ¹æ®æ¡ä»¶æ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼Œä¾‹å¦‚æ‰“å°æ»¡è¶³æ¡ä»¶çš„è¡Œã€‚</p>
<p>ç¤ºä¾‹ï¼šæ‰“å°åŒ…å«â€œbananaâ€è¿™ä¸€å•è¯çš„è¡Œï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;apple 10\nbanana 20&quot;</span> | awk <span class="string">&#x27;$1 == &quot;banana&quot; &#123;print $0&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">banana 20</span><br></pre></td></tr></table></figure>



<h3 id="å†…ç½®å˜é‡"><a href="#å†…ç½®å˜é‡" class="headerlink" title="å†…ç½®å˜é‡"></a>å†…ç½®å˜é‡</h3><p>awk æä¾›äº†ä¸€äº›å†…ç½®å˜é‡ï¼Œæ¯”å¦‚ï¼š</p>
<p>NRï¼šå½“å‰å¤„ç†çš„è¡Œå·ã€‚<br>NFï¼šå½“å‰è¡Œçš„å­—æ®µæ•°ã€‚<br>$0ï¼šæ•´è¡Œæ–‡æœ¬ã€‚<br>$1, $2, $3ï¼šæ¯è¡Œçš„ç¬¬ 1ã€2ã€3 åˆ—ã€‚<br>FSï¼šå­—æ®µåˆ†éš”ç¬¦ï¼ˆé»˜è®¤æ˜¯ç©ºæ ¼æˆ–åˆ¶è¡¨ç¬¦ï¼‰ã€‚<br>æ‰“å°æ ¼å¼åŒ–è¾“å‡º<br>awk å¯ä»¥è‡ªå®šä¹‰è¾“å‡ºæ ¼å¼ï¼Œæ¯”å¦‚æŒ‡å®šåˆ—å®½ã€å¯¹é½ç­‰ã€‚</p>
<p>ç¤ºä¾‹ï¼šè¾“å‡ºæ¯ä¸ªå­—æ®µçš„å›ºå®šå®½åº¦ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">&quot;apple 10\nbanana 20&quot;</span> | awk <span class="string">&#x27;&#123;printf &quot;%-10s %10s\n&quot;, $1, $2&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<p>è¾“å‡ºï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apple           10</span><br><span class="line">banana          20</span><br></pre></td></tr></table></figure>





<h2 id="cadvsior"><a href="#cadvsior" class="headerlink" title="cadvsior"></a>cadvsior</h2><p>å®‰è£…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --volume=/:/rootfs:ro \</span><br><span class="line">  --volume=/var/run:/var/run:ro \</span><br><span class="line">  --volume=/sys:/sys:ro \</span><br><span class="line">  --volume=/var/lib/docker/:/var/lib/docker:ro \</span><br><span class="line">  --volume=/dev/disk/:/dev/disk:ro \</span><br><span class="line">  --publish=8080:8080 \</span><br><span class="line">  --detach=<span class="literal">true</span> \</span><br><span class="line">  --name=cadvisor \</span><br><span class="line">  google/cadvisor:latest</span><br></pre></td></tr></table></figure>



<p>æ­¤æ—¶å¯ä»¥åœ¨8080è®¿é—®</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203193536021.png" alt="image-20241203193536021"></p>
<p>åœ¨prometheusç»‘å®šçš„é…ç½®æ–‡ä»¶æ·»åŠ ç›‘æ§æº</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /opt/prometheus/config/prometheus.yml</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203202747980.png" alt="image-20241203202747980"></p>
<p>é‡å¯prometheus</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart prometheus</span><br></pre></td></tr></table></figure>

<p>é™å¾…ç‰‡åˆ»å³å¯æ”¶åˆ°è¿”å›çš„æ–°æ•°æ®</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203202901001.png" alt="image-20241203202901001"></p>
<h2 id="grafana"><a href="#grafana" class="headerlink" title="grafana"></a>grafana</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name=grafana -p 3000:3000 grafana/grafana</span><br></pre></td></tr></table></figure>

<p>ä¹‹åå¯ä»¥åœ¨ç«¯å£3000è®¿é—®</p>
<p>é»˜è®¤è´¦å·å¯†ç </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin</span><br><span class="line">admin</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€æ¬¡ä¼šæç¤ºä¿®æ”¹å¯†ç </p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203202038317.png" alt="image-20241203202038317"></p>
<p>å…ˆæ·»åŠ æ•°æ®æº</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203202125565.png" alt="image-20241203202125565"></p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203202150910.png" alt="image-20241203202150910"></p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203202212419.png" alt="image-20241203202212419"></p>
<p>å†å¯¼å…¥ç›‘æ§æ¨¡æ¿</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203202246323.png" alt="image-20241203202246323"></p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203202321103.png" alt="image-20241203202321103"></p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203202349339.png" alt="image-20241203202349339"></p>
<p>ä¹‹åå³å¯çœ‹åˆ°ç›‘æ§æ•°æ®</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203202420197.png" alt="image-20241203202420197"></p>
<h2 id="node-exporter"><a href="#node-exporter" class="headerlink" title="node exporter"></a>node exporter</h2><p>å…ˆåˆ›å»ºå®¹å™¨ï¼Œä½¿ç”¨ â€“net&#x3D;â€hostâ€&#96; ç½‘ç»œæ¨¡å¼å…±äº«ä¸»æœºç½‘ç»œå †æ ˆï¼Œä¸éœ€è¦-pè¿›è¡Œç«¯å£æ˜ å°„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d   --name=node-exporter   --net=<span class="string">&quot;host&quot;</span>   --pid=<span class="string">&quot;host&quot;</span>   -v <span class="string">&quot;/:/host:ro,rslave&quot;</span>   quay.io/prometheus/node-exporter:latest   --path.rootfs=/host</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203202633848.png" alt="image-20241203202633848"></p>
<h2 id="å†æ¬¡é…ç½®åˆ°å‰ç«¯å±•ç¤º"><a href="#å†æ¬¡é…ç½®åˆ°å‰ç«¯å±•ç¤º" class="headerlink" title="å†æ¬¡é…ç½®åˆ°å‰ç«¯å±•ç¤º"></a>å†æ¬¡é…ç½®åˆ°å‰ç«¯å±•ç¤º</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /opt/prometheus/config/prometheus.yml</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203231340915.png" alt="image-20241203231340915"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart prometheus</span><br></pre></td></tr></table></figure>

<p>é™å¾…ä¸€ä¼šå³å¯</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203231321355.png" alt="image-20241203231321355"></p>
<p>å¯¹äºGrafanaï¼Œä¾æ—§æ˜¯å¸¦å…¥åº“æ¨¡æ¿ï¼Œç¼–å·9276</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203231507625.png" alt="image-20241203231507625"></p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203231623784.png" alt="image-20241203231623784"></p>
<p>ä¹‹åå³å¯çœ‹åˆ°é¢æ¿</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203231703052.png" alt="image-20241203231703052"></p>
<p>æœ‰äº›æ˜¾ç¤ºæ²¡æœ‰å›¾è¡¨ï¼Œä¸€èˆ¬æ˜¯ä¸‰ä¸ªåŸå› </p>
<ol>
<li>æ²¡æ•°æ®ï¼ˆå–é‡‡ï¼‰</li>
<li>æ—¶é—´ä¸å¯¹ï¼ˆé‡‡é›†çš„æ—¶é—´æˆ³ä¸å®é™…æ—¶é—´ä¸ç¬¦ï¼Œè°ƒèŠ‚æ¨ªè½´æ—¶é—´èŒƒå›´ï¼‰</li>
<li>ä»£ç å†™é”™äº†ï¼ˆå¦‚ä¸‹é¢çš„ç½‘å¡ï¼Œå¯ä»¥æŠŠè¯­å¥çš„ä¸­é—´æ‹¿å»prometheusæŸ¥è¯¢çœ‹æœ‰æ²¡æœ‰æ•°æ®ï¼‰</li>
</ol>
<h2 id="è°ƒæ•´å›¾è¡¨"><a href="#è°ƒæ•´å›¾è¡¨" class="headerlink" title="è°ƒæ•´å›¾è¡¨"></a>è°ƒæ•´å›¾è¡¨</h2><h3 id="cpuä½¿ç”¨ç‡"><a href="#cpuä½¿ç”¨ç‡" class="headerlink" title="cpuä½¿ç”¨ç‡"></a>cpuä½¿ç”¨ç‡</h3><p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203232815565.png" alt="image-20241203232815565"></p>
<p>æœ‰ç»“æœçš„</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_cpu_seconds_total&#123;instance=~<span class="string">&quot;<span class="variable">$node</span>&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203232842329.png" alt="image-20241203232842329"></p>
<p>åŠ ä¸€ä¸ªirateå°±æ²¡äº†</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irate(node_cpu_seconds_total&#123;instance=~<span class="string">&quot;<span class="variable">$node</span>&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125;[1m])</span><br></pre></td></tr></table></figure>



<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203232953786.png" alt="image-20241203232953786"></p>
<p>æ¨æµ‹<code>node_cpu_seconds_total</code> åªè¢«æ›´æ–°ä¸é¢‘ç¹ï¼Œå¢åŠ æ—¶é—´èŒƒå›´ï¼Œåˆ°2åˆ†é’Ÿï¼Œå¯ä»¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irate(node_cpu_seconds_total&#123;instance=~<span class="string">&quot;<span class="variable">$node</span>&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125;[2m])</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203233413063.png" alt="image-20241203233413063"></p>
<p>äºæ˜¯é—®é¢˜è§£å†³</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">100 - (avg(irate(node_cpu_seconds_total&#123;instance=~<span class="string">&quot;<span class="variable">$node</span>&quot;</span>,mode=<span class="string">&quot;idle&quot;</span>&#125;[2m])) * 100)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203233919379.png" alt="image-20241203233919379"></p>
<h3 id="ç£ç›˜è¯»å†™é€Ÿç‡"><a href="#ç£ç›˜è¯»å†™é€Ÿç‡" class="headerlink" title="ç£ç›˜è¯»å†™é€Ÿç‡"></a>ç£ç›˜è¯»å†™é€Ÿç‡</h3><p>ç‚¹è¿›å»å‘ç°å…·æœ‰åŒæ ·çš„é—®é¢˜ï¼Œæ—¶é—´ç‰‡ä»1mæ”¹ä¸º2mè§£å†³ï¼Œæœ€åä¸€ä¸ªä¸ºå®æ—¶ioï¼Œæ— dataï¼ŒæŸ¥è¯¢æ™®ç½—ç±³ä¿®æ–¯ï¼Œè¿”å›çŠ¶æ€ç 0</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203234214204.png" alt="image-20241203234214204"></p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241204000357533.png" alt="image-20241204000357533"></p>
<h3 id="ç£ç›˜è¯»å†™å®¹é‡"><a href="#ç£ç›˜è¯»å†™å®¹é‡" class="headerlink" title="ç£ç›˜è¯»å†™å®¹é‡"></a>ç£ç›˜è¯»å†™å®¹é‡</h3><p>ä¸ä¸Šé¢ç±»ä¼¼å¤„ç†</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203234646417.png" alt="image-20241203234646417"></p>
<h3 id="ç£ç›˜IOè¯»å†™æ—¶é—´"><a href="#ç£ç›˜IOè¯»å†™æ—¶é—´" class="headerlink" title="ç£ç›˜IOè¯»å†™æ—¶é—´"></a>ç£ç›˜IOè¯»å†™æ—¶é—´</h3><p>ç±»ä¼¼å¤„ç†ï¼Œå¯ä»¥æ˜¾ç¤ºæ•°æ®ï¼ˆå®é™…ä¸Šå››æ¡æŸ¥è¯¢ï¼Œå‰ä¸¤ä¸ªæŒ‡æ ‡nodataï¼ŒåŸå› å°šä¸æ¸…æ¥šï¼Œåä¸¤ä¸ªæœ‰ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203235634961.png" alt="image-20241203235634961"></p>
<h3 id="ç£ç›˜æ¯ç§’IOè€—æ—¶"><a href="#ç£ç›˜æ¯ç§’IOè€—æ—¶" class="headerlink" title="ç£ç›˜æ¯ç§’IOè€—æ—¶"></a>ç£ç›˜æ¯ç§’IOè€—æ—¶</h3><p>ç±»ä¼¼å¤„ç†ï¼Œè§£å†³</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203235842715.png" alt="image-20241203235842715"></p>
<h3 id="ç½‘ç»œè¿›å‡ºæµé‡"><a href="#ç½‘ç»œè¿›å‡ºæµé‡" class="headerlink" title="ç½‘ç»œè¿›å‡ºæµé‡"></a>ç½‘ç»œè¿›å‡ºæµé‡</h3><p>æ¯”å¦‚ä¸‹é¢è¿™ä¸ªæ˜¯é»˜è®¤çš„ç½‘å¡åç§°ä¸å¯¹</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203231809571.png" alt="image-20241203231809571"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irate(node_network_receive_bytes_total&#123;instance=~<span class="string">&#x27;$node&#x27;</span>,device=~<span class="string">&#x27;$nic&#x27;</span>&#125;[5m])*8</span><br></pre></td></tr></table></figure>



<p>æ”¹ä¸ºå®é™…çš„ç½‘å¡å³å¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irate(node_network_receive_bytes_total&#123;instance=~<span class="string">&#x27;$node&#x27;</span>,device=~<span class="string">&#x27;ens33&#x27;</span>&#125;[5m])*8</span><br></pre></td></tr></table></figure>



<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203231933298.png" alt="image-20241203231933298"></p>
<h3 id="åˆ†åŒºæ˜¾ç¤º"><a href="#åˆ†åŒºæ˜¾ç¤º" class="headerlink" title="åˆ†åŒºæ˜¾ç¤º"></a>åˆ†åŒºæ˜¾ç¤º</h3><p>åˆ·æ–°è§£å†³</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241204001130367.png" alt="image-20241204001130367"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/27/openEuler-k8s/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="FlareBall">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlareBall's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/11/27/openEuler-k8s/" class="post-title-link" itemprop="url">openeuler+docker+k8s</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-11-27 00:12:00" itemprop="dateCreated datePublished" datetime="2024-11-27T00:12:00+08:00">2024-11-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-12-03 19:09:04" itemprop="dateModified" datetime="2024-12-03T19:09:04+08:00">2024-12-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>è®°å½•å­¦ä¹ éƒ¨ç½²k8sè¿‡ç¨‹ä¸­è¸©è¿‡çš„å‘ï¼Œä¸‹æ¬¡éƒ¨ç½²æœ‰ä¸ªå‚è€ƒ</p>
<h1 id="èŠ‚ç‚¹è§„åˆ’"><a href="#èŠ‚ç‚¹è§„åˆ’" class="headerlink" title="èŠ‚ç‚¹è§„åˆ’"></a>èŠ‚ç‚¹è§„åˆ’</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">k8s 1.20.2 + docker + flannel 0.20.2</span><br><span class="line"></span><br><span class="line">node0 192.168.126.139 master 4GB 40GB</span><br><span class="line">node1 192.168.126.140 slave 4GB 40GB</span><br><span class="line">node2 192.168.126.141 slave 4GB 40GB</span><br></pre></td></tr></table></figure>





<h1 id="å‰ç½®å·¥ä½œï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰"><a href="#å‰ç½®å·¥ä½œï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰" class="headerlink" title="å‰ç½®å·¥ä½œï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰"></a>å‰ç½®å·¥ä½œï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h1><ol>
<li><p>ä¿®è‡ªå®šä¹‰ä¸»æœºåï¼Œå³åˆ»åº”ç”¨ï¼Œä»¥ä¸€ä¸ªä¸ºä¾‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hostnamectl set-hostname node1</span></span><br><span class="line"><span class="comment"># sudo -i</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124234104685.png" alt="image-20241124234104685"></p>
</li>
<li><p>æ•´ä¸ªé¡ºæ‰‹çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œç¬”è€…è¿™é‡Œé€‰äº†nano</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install nano</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125000040548.png" alt="image-20241125000040548"></p>
</li>
<li><p>é…ç½®ä¸»æœºåè§£æ</p>
<p><code>/etc/hosts</code>æ˜¯ä¸€ä¸ªæœ¬åœ°çš„é™æ€æ–‡ä»¶ï¼Œç”¨äºå°†ä¸»æœºåæ˜ å°„åˆ° IP åœ°å€ã€‚å½“ç³»ç»Ÿéœ€è¦è§£æä¸»æœºåæ—¶ï¼Œé¦–å…ˆæŸ¥æ‰¾è¯¥æ–‡ä»¶ã€‚å¦‚æœæ‰¾åˆ°åŒ¹é…é¡¹ï¼Œåˆ™ä½¿ç”¨è¯¥ IP åœ°å€ï¼Œè€Œä¸é€šè¿‡ DNS æœåŠ¡å™¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nano /etc/hosts</span></span><br></pre></td></tr></table></figure>

<p>æ·»åŠ å¦‚ä¸‹å†…å®¹</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125000357924.png" alt="image-20241125000357924"></p>
</li>
<li><p>å…³é—­swapï¼Œselinuxï¼Œç¦ç”¨é˜²ç«å¢™</p>
<p>k8sè¿è¡Œéœ€è¦ç¦ç”¨swapï¼ˆäº¤æ¢ç©ºé—´ï¼‰æ›´å¥½çš„è¿›è¡Œå®¹å™¨å†…å­˜ç®¡ç†ã€‚<code>swapoff -a</code>å…³é—­swapã€‚<code>/etc/fstab</code> ç”¨äºå®šä¹‰ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿã€åˆ†åŒºã€äº¤æ¢ç©ºé—´ï¼ˆswapï¼‰ç­‰ä¿¡æ¯ï¼Œ<code>sed -ri &#39;s/.*swap.*/#&amp;/&#39; /etc/fstab</code>æ³¨é‡Šæ‰å…¶ä¸­å…³äºswapçš„ä¿¡æ¯ã€‚<code>setenforce 0</code>ç¦ç”¨ SELinux çš„å¼ºåˆ¶å®‰å…¨ç­–ç•¥é¿å…k8sé‡åˆ°æƒé™é—®é¢˜ã€‚<code>systemctl stop firewalld &amp;&amp; systemctl disable firewalld</code>å…³é—­å¹¶ç¦ç”¨é˜²ç«å¢™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># swapoff -a</span></span><br><span class="line"><span class="comment"># sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab</span></span><br><span class="line"><span class="comment"># setenforce 0</span></span><br><span class="line"><span class="comment"># systemctl stop firewalld &amp;&amp; systemctl disable firewalld</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125001106539.png" alt="image-20241125001106539"></p>
</li>
<li><p>å¯ç”¨å†…æ ¸æ¨¡å—</p>
<ol>
<li><p>**<code>modprobe overlay</code>**ï¼šåŠ è½½ Overlay æ–‡ä»¶ç³»ç»Ÿï¼ˆç”¨äºå®¹å™¨è¿è¡Œæ—¶ï¼‰å†…æ ¸æ¨¡å—ï¼Œæ”¯æŒå®¹å™¨æ–‡ä»¶ç³»ç»Ÿã€‚</p>
</li>
<li><p>**<code>modprobe br_netfilter</code>**ï¼š åŠ è½½ç½‘ç»œæ¡¥æ¥è¿‡æ»¤æ¨¡å—ï¼Œç”¨äºå®¹å™¨å’Œä¸»æœºä¹‹é—´çš„æµé‡æ§åˆ¶ã€‚</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># modprobe overlay</span></span><br><span class="line"><span class="comment"># modprobe br_netfilter</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>ç½‘ç»œè½¬å‘å¸¸ç”¨é…ç½®</p>
<ol>
<li><strong><code>net.bridge.bridge-nf-call-iptables = 1</code></strong><br>éƒ¨ç½²å®¹å™¨æ—¶ï¼Œå®¹å™¨ç½‘ç»œé€šå¸¸ä¼šä¸å®¿ä¸»æœºçš„ç½‘ç»œè¿›è¡Œæ¡¥æ¥ã€‚åœ¨å¤„ç†è·¨è¶Šç½‘ç»œæ¡¥æ¥çš„æ•°æ®åŒ…æ—¶ï¼Œè°ƒç”¨ <code>iptables</code> è¿›è¡ŒåŒ…è¿‡æ»¤ã€‚é¿å…å®¹å™¨é—´çš„æµé‡è¢«è¯¯æ‹¦æˆªã€‚</li>
<li><strong><code>net.ipv4.ip_forward = 1</code></strong><br>å¯ç”¨ IP è½¬å‘ï¼Œä½¿ä¸»æœºèƒ½å¤Ÿè½¬å‘ç½‘ç»œæµé‡ï¼Œä¿è¯ä¸åŒèŠ‚ç‚¹é—´çš„ Pod å¯ä»¥ç›¸äº’é€šä¿¡ã€‚</li>
<li><strong><code>net.bridge.bridge-nf-call-ip6tables = 1</code></strong><br>ä¸ç¬¬ä¸€ä¸ªå‚æ•°ç±»ä¼¼ï¼Œå…³äºipv6çš„ã€‚</li>
<li><strong><code>vm.swappiness=0</code></strong><br>è®¾ç½®è™šæ‹Ÿå†…å­˜çš„äº¤æ¢è¡Œä¸ºï¼Œ<code>swappiness</code> æ§åˆ¶å†…æ ¸å†³å®šä»€ä¹ˆæ—¶å€™å°†å†…å­˜é¡µé¢äº¤æ¢åˆ°ç¡¬ç›˜ä¸Šã€‚<code>swappiness=0</code> è¡¨ç¤ºå†…æ ¸å°½é‡é¿å…äº¤æ¢ï¼Œä¼˜å…ˆä½¿ç”¨ç‰©ç†å†…å­˜ï¼Œé¿å…é¢‘ç¹çš„å†…å­˜äº¤æ¢ã€‚</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> &gt; /etc/sysctl.d/kubernetes.conf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-iptables = 1</span></span><br><span class="line"><span class="string">net.ipv4.ip_forward = 1</span></span><br><span class="line"><span class="string">net.bridge.bridge-nf-call-ip6tables = 1</span></span><br><span class="line"><span class="string">vm.swappiness=0</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure>

<p>ç”Ÿæ•ˆè§„åˆ™</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sysctl -p /etc/sysctl.d/kubernetes.conf</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="dockerå®‰è£…ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰"><a href="#dockerå®‰è£…ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰" class="headerlink" title="dockerå®‰è£…ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰"></a>dockerå®‰è£…ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf install -y docker</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125001725376.png" alt="image-20241125001725376"></p>
<p>å¼€æœºè‡ªå¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl enable docker &amp;&amp; systemctl start docker</span></span><br></pre></td></tr></table></figure>

<p>æŸ¥çœ‹ç‰ˆæœ¬ï¼Œç¡®å®šå®‰è£…æˆåŠŸ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker --version</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125002237232.png" alt="image-20241125002237232"></p>
<h1 id="ç½‘ç»œç»„ä»¶é…ç½®å‡†å¤‡ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰"><a href="#ç½‘ç»œç»„ä»¶é…ç½®å‡†å¤‡ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰" class="headerlink" title="ç½‘ç»œç»„ä»¶é…ç½®å‡†å¤‡ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰"></a>ç½‘ç»œç»„ä»¶é…ç½®å‡†å¤‡ï¼ˆæ‰€æœ‰èŠ‚ç‚¹ï¼‰</h1><p>Flannel æ˜¯ Kubernetes çš„ç½‘ç»œæ’ä»¶ï¼Œç”¨äºä¸ºé›†ç¾¤ä¸­çš„å®¹å™¨æä¾›è·¨èŠ‚ç‚¹çš„ç½‘ç»œé€šä¿¡ï¼Œå¸¸ç”¨çš„è¿˜æœ‰calicoï¼Œflannelç®€å•æ˜“ç”¨ï¼ŒcalicoåŠŸèƒ½æ›´å¼ºå¤§</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir /opt/yaml/</span></span><br><span class="line"><span class="comment"># nano /opt/yaml/kube-flannel.yaml</span></span><br></pre></td></tr></table></figure>

<p>å†…å®¹å¦‚ä¸‹ï¼Œæ³¨æ„è¿™é‡Œçš„é•œåƒæ˜¯å›½å¤–çš„ï¼Œå¯ä»¥æ¢æˆå›½å†…çš„ï¼Œä¹Ÿå¯ä»¥ç»™dockeré…ç½®ä»£ç†</p>
<p>å¦å¤–ï¼Œå¦‚æœä½¿ç”¨å…¶ä»–ç‰ˆæœ¬çš„flannelï¼Œå¯ä»¥ç›´æ¥å»å…¶githubä»“åº“ä¸‹è½½å¯¹åº”ymlæ–‡ä»¶</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-flannel</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">pod-security.kubernetes.io/enforce:</span> <span class="string">privileged</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">nodes/status</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;networking.k8s.io&quot;</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">clustercidrs</span></span><br><span class="line">  <span class="attr">verbs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-flannel</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">flannel</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-flannel</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-flannel-cfg</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-flannel</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">node</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">cni-conf.json:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;name&quot;: &quot;cbr0&quot;,</span></span><br><span class="line"><span class="string">      &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span></span><br><span class="line"><span class="string">      &quot;plugins&quot;: [</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;flannel&quot;,</span></span><br><span class="line"><span class="string">          &quot;delegate&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;hairpinMode&quot;: true,</span></span><br><span class="line"><span class="string">            &quot;isDefaultGateway&quot;: true</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">          &quot;type&quot;: &quot;portmap&quot;,</span></span><br><span class="line"><span class="string">          &quot;capabilities&quot;: &#123;</span></span><br><span class="line"><span class="string">            &quot;portMappings&quot;: true</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      ]</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span>  <span class="attr">net-conf.json:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    &#123;</span></span><br><span class="line"><span class="string">      &quot;Network&quot;: &quot;10.244.0.0/16&quot;,</span></span><br><span class="line"><span class="string">      &quot;Backend&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;Type&quot;: &quot;vxlan&quot;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kube-flannel-ds</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-flannel</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">node</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">tier:</span> <span class="string">node</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">flannel</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">affinity:</span></span><br><span class="line">        <span class="attr">nodeAffinity:</span></span><br><span class="line">          <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">            <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">kubernetes.io/os</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">linux</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">priorityClassName:</span> <span class="string">system-node-critical</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">        <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">flannel</span></span><br><span class="line">      <span class="attr">initContainers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install-cni-plugin</span></span><br><span class="line">        <span class="comment">#image: flannelcni/flannel-cni-plugin:v1.1.2 #for ppc64le and mips64le (dockerhub limitations may apply)</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.io/rancher/mirrored-flannelcni-flannel-cni-plugin:v1.1.2</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">cp</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-f</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/flannel</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/opt/cni/bin/flannel</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni-plugin</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/opt/cni/bin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install-cni</span></span><br><span class="line">       <span class="comment">#image: flannelcni/flannel:v0.20.2 #for ppc64le and mips64le (dockerhub limitations may apply)</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.io/rancher/mirrored-flannelcni-flannel:v0.20.2</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">cp</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">-f</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/etc/kube-flannel/cni-conf.json</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/etc/cni/net.d/10-flannel.conflist</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flannel-cfg</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kube-flannel</span></span><br><span class="line">       <span class="comment">#image: flannelcni/flannel:v0.20.2 #for ppc64le and mips64le (dockerhub limitations may apply)</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">docker.io/rancher/mirrored-flannelcni-flannel:v0.20.2</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/opt/bin/flanneld</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--ip-masq</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">--kube-subnet-mgr</span></span><br><span class="line">        <span class="attr">resources:</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">&quot;50Mi&quot;</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">privileged:</span> <span class="literal">false</span></span><br><span class="line">          <span class="attr">capabilities:</span></span><br><span class="line">            <span class="attr">add:</span> [<span class="string">&quot;NET_ADMIN&quot;</span>, <span class="string">&quot;NET_RAW&quot;</span>]</span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">          <span class="attr">valueFrom:</span></span><br><span class="line">            <span class="attr">fieldRef:</span></span><br><span class="line">              <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">EVENT_QUEUE_DEPTH</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">&quot;5000&quot;</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">run</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/run/flannel</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flannel-cfg</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/etc/kube-flannel/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">xtables-lock</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/run/xtables.lock</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">run</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/run/flannel</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni-plugin</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/opt/cni/bin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">cni</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/etc/cni/net.d</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">flannel-cfg</span></span><br><span class="line">        <span class="attr">configMap:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">kube-flannel-cfg</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">xtables-lock</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/run/xtables.lock</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">FileOrCreate</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å®‰è£…cniå¹¶é…ç½®åˆ°flannelçš„é»˜è®¤è·¯å¾„</p>
<p>CNIï¼ˆContainer Network Interfaceï¼‰æ˜¯å®¹å™¨ç½‘ç»œæ¥å£çš„ç¼©å†™ï¼Œä¸ºå®¹å™¨æä¾›ç½‘ç»œé…ç½®å’Œç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸ºå®¹å™¨åˆ†é… IP åœ°å€ã€è®¾ç½®ç½‘ç»œç­–ç•¥ã€è·¯ç”±æµé‡ç­‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf install -y containernetworking-plugins</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125004635626.png" alt="image-20241125004635626"></p>
<p>copy cnié…ç½®åˆ°flannelé»˜è®¤è¯»å–çš„ç›®å½•</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir -p /opt/cni/bin</span></span><br><span class="line"><span class="comment"># cp /usr/libexec/cni/* /opt/cni/bin/</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125005121394.png" alt="image-20241125005121394"></p>
<p>ä¾èµ–ç»„ä»¶conntrack</p>
<p><code>conntrack</code>æ˜¯ä¸€ç§ç”¨æˆ·ç©ºé—´å·¥å…·ï¼Œç”¨äºæ“ä½œå’Œç®¡ç† <code>netfilter</code>è·Ÿè¸ªè¿æ¥çš„çŠ¶æ€ï¼Œæ­¤å¤„ç”¨äºå¤„ç†å®¹å™¨é—´çš„ç½‘ç»œè¿æ¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf install -y conntrack</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125013731754.png" alt="image-20241125013731754"></p>
<p>kubeletå¼€å¯è‡ªå¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl enable kubelet.service &amp;&amp; systemctl start kubelet.service</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125013919560.png" alt="image-20241125013919560"></p>
<h1 id="K8sä¸»èŠ‚ç‚¹"><a href="#K8sä¸»èŠ‚ç‚¹" class="headerlink" title="K8sä¸»èŠ‚ç‚¹"></a>K8sä¸»èŠ‚ç‚¹</h1><ol>
<li>å®‰è£…ç»„ä»¶</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># dnf install -y kubernetes-kubeadm kubernetes-kubelet kubernetes-master</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241127000337927.png" alt="image-20241127000337927"></p>
<ol start="2">
<li>åˆå§‹åŒ–æ§åˆ¶å¹³é¢</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --apiserver-advertise-address=192.168.126.139 \</span><br><span class="line">  --image-repository registry.aliyuncs.com/google_containers \</span><br><span class="line">  --kubernetes-version v1.20.2 \</span><br><span class="line">  --service-cidr=10.1.0.0/16 --pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œç¬”è€…é…ç½®äº†é™„å½•çš„dockerä»£ç†ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥è€ƒè™‘åœ¨è¿™é‡Œç›´æ¥æŒ‡å®šå›½å†…æºï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§æ–¹å¼</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --kubernetes-version=1.20.2 --apiserver-advertise-address=192.168.126.139 --cri-socket=/var/run/isulad.sock --image-repository=registry.aliyuncs.com/google_containers --service-cidr=10.96.0.0/12 --pod-network-cidr=10.244.0.0/16 --v=5</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºä»¥ä¸‹ä¿¡æ¯åˆå§‹åŒ–æˆåŠŸ</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125121721414.png" alt="image-20241125121721414"></p>
<ol start="3">
<li>ä¿å­˜joinå‘½ä»¤åœ¨ä»èŠ‚ç‚¹è¿è¡Œ</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubeadm <span class="built_in">join</span> 192.168.126.139:6443 --token dokaoz.sfrch50yf43iubsz \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:44507460bd82478c7447280af83889673149a76a3a24f75b7e828e9b56a69dc4</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>é…ç½®kubectl</li>
</ol>
<p><strong><code>/etc/profile</code></strong> æ˜¯ä¸€ä¸ªç³»ç»Ÿçº§çš„ shell é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸ç”¨äºè®¾ç½®æ‰€æœ‰ç”¨æˆ·çš„ç¯å¢ƒå˜é‡å’Œå¯åŠ¨æ—¶æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nano /etc/profile</span></span><br></pre></td></tr></table></figure>

<p>æœ€åé¢æ·»åŠ </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">export</span> <span class="string">KUBECONFIG=/etc/kubernetes/admin.conf</span></span><br></pre></td></tr></table></figure>

<p>åº”ç”¨æ”¹å˜</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># source /etc/profile</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶æç¤ºNotReadyï¼Œæ˜¯å› ä¸ºç½‘ç»œæ’ä»¶æœªé…ç½®ï¼ˆè¿™é‡Œç¬”è€…å·²ç»åœ¨ä»èŠ‚ç‚¹æ‰§è¡Œäº†1. 2æ­¥éª¤åŠ å…¥äº†é›†ç¾¤ï¼‰</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125122642008.png" alt="image-20241125122642008"></p>
<ol start="6">
<li>é…ç½®flannelï¼Œä¹‹å‰å¯¼å…¥çš„é…ç½®ç›´æ¥åº”ç”¨å³å¯ï¼ˆå®é™…ä¸Šéƒ¨ç½²å®Œå‘ç°ä»èŠ‚ç‚¹ä¸éœ€è¦ä½¿ç”¨kubectl apply -f &#x2F;opt&#x2F;yaml&#x2F;kube-flannel.yamlé…ç½®flannelï¼Œä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ç½‘ç»œï¼ŒåŸå› è¿˜æ²¡ææ˜ç™½ï¼Œå‘++ï¼‰</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f /opt/yaml/kube-flannel.yaml</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125123047278.png" alt="image-20241125123047278"></p>
<ol start="7">
<li>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹flanneléƒ¨ç½²è¿›åº¦å’Œé›†ç¾¤çŠ¶æ€</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes</span><br><span class="line">kubectl get pods -n kube-flannel</span><br></pre></td></tr></table></figure>

<p>å®‰è£…å®ŒæˆåçŠ¶æ€å¦‚ä¸‹æ‰€ç¤º</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125123259156.png" alt="image-20241125123259156"></p>
<h1 id="K8sä»èŠ‚ç‚¹"><a href="#K8sä»èŠ‚ç‚¹" class="headerlink" title="K8sä»èŠ‚ç‚¹"></a>K8sä»èŠ‚ç‚¹</h1><ol>
<li>å®‰è£…ç»„ä»¶</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ~]# dnf install -y kubernetes-kubeadm kubernetes-kubelet kubernetes-node</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125010758059.png" alt="image-20241125010758059"></p>
<ol start="2">
<li>åŠ å…¥é›†ç¾¤</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubeadm <span class="built_in">join</span> 192.168.126.139:6443 --token dokaoz.sfrch50yf43iubsz \</span><br><span class="line">    --discovery-token-ca-cert-hash sha256:44507460bd82478c7447280af83889673149a76a3a24f75b7e828e9b56a69dc4</span><br></pre></td></tr></table></figure>

<p>æ˜¾ç¤ºå¦‚ä¸‹ä¿¡æ¯åŠ å…¥æˆåŠŸ</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125121943414.png" alt="image-20241125121943414"></p>
<h1 id="é›†ç¾¤æµ‹è¯•"><a href="#é›†ç¾¤æµ‹è¯•" class="headerlink" title="é›†ç¾¤æµ‹è¯•"></a>é›†ç¾¤æµ‹è¯•</h1><p>æ­¤å¤„é€‰æ‹©nginxè¿›è¡Œæµ‹è¯•åˆ›å»ºå¹¶æš´éœ²ç«¯å£</p>
<p>ã€æ¥è‡ªGPTã€‘</p>
<ol>
<li><code>kubectl create deployment nginx --image=nginx</code></li>
</ol>
<p>**<code>kubectl create deployment</code>**ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„éƒ¨ç½²ï¼ˆDeploymentï¼‰ã€‚Deployment æ˜¯ Kubernetes ä¸­ç®¡ç†åº”ç”¨ç”Ÿå‘½å‘¨æœŸçš„èµ„æºå¯¹è±¡ï¼Œå®ƒå®šä¹‰äº†åº”ç”¨çš„æœŸæœ›çŠ¶æ€ï¼ˆä¾‹å¦‚ Pod æ•°é‡ã€å‰¯æœ¬ã€å®¹å™¨é•œåƒç­‰ï¼‰ã€‚</p>
<p>**<code>nginx</code>**ï¼šæŒ‡å®šéƒ¨ç½²çš„åç§°ã€‚è¿™ä¸ªåå­—ä¼šè¢«ç”¨ä½œåˆ›å»ºçš„ Deployment èµ„æºçš„æ ‡è¯†ã€‚</p>
<p>**<code>--image=nginx</code>**ï¼šæŒ‡å®šå®¹å™¨ä½¿ç”¨çš„é•œåƒã€‚è¿™é‡ŒæŒ‡å®šçš„æ˜¯ <code>nginx</code> é•œåƒï¼Œæ„å‘³ç€åˆ›å»ºçš„ Pod ä¸­å°†è¿è¡Œ Nginx Web æœåŠ¡å™¨ã€‚è¿™ä¸ªé•œåƒæ˜¯ä» Docker Hub ä¸­æ‹‰å–çš„å®˜æ–¹ Nginx é•œåƒã€‚</p>
<ol start="2">
<li><code>kubectl expose deployment nginx --port=80 --type=NodePort</code></li>
</ol>
<p>**<code>kubectl expose</code>**ï¼šè¯¥å‘½ä»¤ç”¨äºæš´éœ²ä¸€ä¸ªæœåŠ¡ï¼Œä½¿å…¶å¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®ã€‚é€šå¸¸ï¼ŒKubernetes ä½¿ç”¨ <code>Service</code> èµ„æºæ¥æš´éœ²åº”ç”¨ï¼Œä½¿å…¶åœ¨é›†ç¾¤å†…æˆ–é›†ç¾¤å¤–å¯è®¿é—®ã€‚</p>
<p>**<code>deployment nginx</code>**ï¼šæš´éœ²çš„å¯¹è±¡æ˜¯ä¹‹å‰åˆ›å»ºçš„ <code>nginx</code> Deploymentã€‚æ„å‘³ç€è¿™ä¸ªå‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ª Serviceï¼Œå°† <code>nginx</code> éƒ¨ç½²æš´éœ²å‡ºå»ã€‚</p>
<p>**<code>--port=80</code>**ï¼šæŒ‡å®šæš´éœ²æœåŠ¡çš„ç«¯å£å·ï¼Œ<code>80</code> æ˜¯ Nginx çš„é»˜è®¤ HTTP æœåŠ¡ç«¯å£ã€‚è¿™ä¸ªç«¯å£å°†ç”¨äºè®¿é—® Nginx Web æœåŠ¡å™¨ã€‚</p>
<p>**<code>--type=NodePort</code>**ï¼šæŒ‡å®šæœåŠ¡æš´éœ²çš„ç±»å‹ä¸º <code>NodePort</code>ã€‚<code>NodePort</code> ç±»å‹çš„æœåŠ¡ä¼šåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œä½¿é›†ç¾¤å¤–éƒ¨çš„ç”¨æˆ·å¯ä»¥é€šè¿‡èŠ‚ç‚¹çš„ IP åœ°å€å’ŒæŒ‡å®šçš„ç«¯å£å·æ¥è®¿é—®æœåŠ¡ã€‚Kubernetes ä¼šè‡ªåŠ¨ä¸ºè¯¥æœåŠ¡åˆ†é…ä¸€ä¸ªç«¯å£ï¼Œé»˜è®¤èŒƒå›´æ˜¯ 30000 åˆ° 32767ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl create deployment nginx --image=nginx</span><br><span class="line">kubectl expose deployment nginx --port=80 --<span class="built_in">type</span>=NodePort</span><br></pre></td></tr></table></figure>

<p>æŸ¥è¯¢å½“å‰é›†ç¾¤ä¸­ <strong>Pod</strong> å’Œ <strong>Service</strong> çŠ¶æ€,æŸ¥çœ‹æ˜¯å¦è¿è¡ŒæˆåŠŸ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod,svc</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125123555734.png" alt="image-20241125123555734"></p>
<p>æŸ¥çœ‹podè¿è¡Œçš„èŠ‚ç‚¹å¯ä»¥ç”¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods -o wide</span><br></pre></td></tr></table></figure>



<p>åœ¨ä»èŠ‚ç‚¹æŸ¥çœ‹ï¼Œå¯ä»¥å‘ç°è¿™é‡Œè‡ªåŠ¨éƒ¨ç½²åœ¨åœ¨192.168.126.141èŠ‚ç‚¹ä¸Š</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125123926938.png" alt="image-20241125123926938"></p>
<p>æ‰€æœ‰èŠ‚ç‚¹å‡å¯è®¿é—®nginxæœåŠ¡å™¨</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.126.140:32641</span><br><span class="line">192.168.126.141:32641</span><br><span class="line">192.168.126.142:32641</span><br></pre></td></tr></table></figure>

<p>æ¯”å¦‚ä¸»èŠ‚ç‚¹</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125124035333.png" alt="image-20241125124035333"></p>
<p>æ‰©å±•å‰¯æœ¬</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale deployment nginx --replicas=3</span><br></pre></td></tr></table></figure>





<h1 id="é™„å½•-å¸¸è§é—®é¢˜"><a href="#é™„å½•-å¸¸è§é—®é¢˜" class="headerlink" title="é™„å½•-å¸¸è§é—®é¢˜"></a>é™„å½•-å¸¸è§é—®é¢˜</h1><h2 id="é™æ€ipé…ç½®"><a href="#é™æ€ipé…ç½®" class="headerlink" title="é™æ€ipé…ç½®"></a>é™æ€ipé…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /etc/sysconfig/network-scripts</span></span><br><span class="line"><span class="comment"># nano ifcfg-ens33</span></span><br></pre></td></tr></table></figure>



<p>ç¬”è€…æ–‡ä»¶å¦‚ä¸‹</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241127201159694.png" alt="image-20241127201159694"></p>
<p>å¯¹äºè¦è®¾ç½®çš„é™æ€ipæ‰€å±å­ç½‘ï¼Œå¯ä»¥åœ¨å®¿ä¸»æœºä½¿ç”¨ipconfigå‘½ä»¤æŸ¥è¯¢ï¼Œç¬”è€…ä½¿ç”¨NATé“¾æ¥è™šæ‹Ÿæœºå’Œå®¿ä¸»æœºï¼Œè¿™é‡Œæ˜¯VMnet 8ç½‘ç»œï¼Œç½‘å…³ä¸€èˆ¬é»˜è®¤ä¸º<code>xxx.xxx.xxx.2</code>ï¼ŒDNSç…§æ¬å³å¯ã€‚</p>
<p>æ›´æ”¹å¦‚ä¸‹é€‰é¡¹å³å¯ï¼Œé»„è‰²ç”±<code>dhcp</code>æ”¹ä¸º<code>static</code>ï¼Œçº¢è‰²ä¸ºæ–°åŠ çš„ã€‚</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241127201010320.png" alt="image-20241127200905390"></p>
<p>ä¹‹åé‡å¯ç½‘å¡å³å¯ç”Ÿæ•ˆè®¾ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemctl reload NetworkManager</span></span><br></pre></td></tr></table></figure>

<p>é‡å¯åå·²ç»å¯ä»¥è®¿é—®ç½‘ç»œ</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241203190224671.png" alt="image-20241127202015718"></p>
<p>å®é™…ä¸Šæœ‰æ—¶å€™ç®¡ç”¨ï¼Œæœ‰æ—¶å€™ä¸ç®¡ç”¨ï¼ŒåŸå› ç¬”è€…è¿˜æ²¡å¼„æ˜ç™½ï¼Œå‘++ï¼Œè¿™é‡Œé€‰æ‹©ç²—æš´çš„é‡å¯èŠ‚ç‚¹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># reboot</span></span><br></pre></td></tr></table></figure>







<h2 id="dnfå¤ªæ…¢ï¼ŒæŒ‚ä¸ªç»ˆç«¯ä»£ç†"><a href="#dnfå¤ªæ…¢ï¼ŒæŒ‚ä¸ªç»ˆç«¯ä»£ç†" class="headerlink" title="dnfå¤ªæ…¢ï¼ŒæŒ‚ä¸ªç»ˆç«¯ä»£ç†"></a>dnfå¤ªæ…¢ï¼ŒæŒ‚ä¸ªç»ˆç«¯ä»£ç†</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ~]# <span class="built_in">export</span> http_proxy=<span class="string">&quot;http://192.168.1.104:7890&quot;</span></span><br><span class="line">[root@node0 ~]# <span class="built_in">export</span> https_proxy=<span class="string">&quot;http://192.168.1.104:7890&quot;</span></span><br></pre></td></tr></table></figure>



<h2 id="dockeré…ç½®ä»£ç†ä»¥è®¿é—®å›½å¤–é•œåƒæº"><a href="#dockeré…ç½®ä»£ç†ä»¥è®¿é—®å›½å¤–é•œåƒæº" class="headerlink" title="dockeré…ç½®ä»£ç†ä»¥è®¿é—®å›½å¤–é•œåƒæº"></a>dockeré…ç½®ä»£ç†ä»¥è®¿é—®å›½å¤–é•œåƒæº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@node0 ~]# <span class="built_in">sudo</span> <span class="built_in">mkdir</span> /etc/systemd/system/docker.service.d</span><br><span class="line">[root@node0 ~]# <span class="built_in">cd</span> /etc/systemd/system/docker.service.d</span><br><span class="line">[root@node0 docker.service.d]# nano proxy.conf</span><br><span class="line">[root@node0 docker.service.d]# <span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line">[root@node0 docker.service.d]# <span class="built_in">sudo</span> systemctl restart docker</span><br><span class="line">[root@node0 docker.service.d]# docker info</span><br></pre></td></tr></table></figure>

<p>proxy.confå†…å®¹ä¸º</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">Service</span>] </span><br><span class="line"><span class="string">Environment=&quot;HTTP_PROXY=http://192.168.1.104:7890&quot;</span></span><br><span class="line"><span class="string">Environment=&quot;HTTPS_PROXY=http://192.168.1.104:7890&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241125013251266.png" alt="image-20241125013251266"></p>
<p>åˆå§‹åŒ–æ—¶è­¦å‘Šï¼Œä¸»èŠ‚ç‚¹socatç¼ºå¤±</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[WARNING FileExisting-socat]: socat not found <span class="keyword">in</span> system path</span><br></pre></td></tr></table></figure>

<p>è¡¥ä¸€ä¸ªå³å¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y socat</span><br></pre></td></tr></table></figure>



<h2 id="cgroupsä¸ä¸€è‡´"><a href="#cgroupsä¸ä¸€è‡´" class="headerlink" title="cgroupsä¸ä¸€è‡´"></a>cgroupsä¸ä¸€è‡´</h2><p>åˆå§‹åŒ–æ—¶è­¦å‘Šdocker cgroupsä¸æ¨èä¸ä¸€è‡´ï¼Œåœ¨</p>
<p>â€œ&#x2F;etc&#x2F;docker&#x2F;daemon.jsonâ€æ·»åŠ </p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;exec-opts&quot;:</span> [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>ä¹‹åé‡å¯dockerå’Œå®ˆæŠ¤è¿›ç¨‹å³å¯ï¼ŒæŸ¥çœ‹docker infoå¯ä»¥çœ‹åˆ°å½“å‰çš„cgroups</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@lab2 docker]# nano /etc/docker/daemon.json</span><br><span class="line">[root@lab2 docker]# <span class="built_in">sudo</span> systemctl daemon-reload</span><br><span class="line">[root@lab2 docker]# <span class="built_in">sudo</span> systemctl restart docker</span><br><span class="line">[root@lab2 docker]# docker info</span><br></pre></td></tr></table></figure>

<p>å®Œæ•´æ–‡ä»¶ç¤ºä¾‹</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">â€œ</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;exec-opts&quot;:</span> [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>],</span><br><span class="line">    <span class="attr">&quot;log-driver&quot;:</span> <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;log-opts&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;max-size&quot;:</span> <span class="string">&quot;100m&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;storage-driver&quot;:</span> <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;registry-mirrors&quot;:</span> [</span><br><span class="line">        <span class="string">&quot;https://registry.docker-cn.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://hub-mirror.c.163.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://mirror.baidubce.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;https://ccr.ccs.tencentyun.com&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"><span class="string">â€</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³æŸ¥çœ‹k8sçš„cgroups</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /var/lib/kubelet/config.yaml</span><br></pre></td></tr></table></figure>



<h2 id="åˆ é™¤é…ç½®ä»¥é‡æ–°åˆå§‹åŒ–"><a href="#åˆ é™¤é…ç½®ä»¥é‡æ–°åˆå§‹åŒ–" class="headerlink" title="åˆ é™¤é…ç½®ä»¥é‡æ–°åˆå§‹åŒ–"></a>åˆ é™¤é…ç½®ä»¥é‡æ–°åˆå§‹åŒ–</h2><p>ä¸‹é¢çš„å‘½ä»¤å¯ä»¥åœ¨æ‰€æœ‰èŠ‚ç‚¹åˆ é™¤ç°æœ‰é…ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> kubeadm reset -f</span><br></pre></td></tr></table></figure>

<p>æ­¤å‘½ä»¤ä¸ä¼šåˆ é™¤dockerï¼Œk8sç»„ä»¶ç­‰é•œåƒï¼Œåªä¼šåˆ é™¤åˆå§‹åŒ–çš„å½±å“</p>
<p>ä¸»èŠ‚ç‚¹éœ€è¦é¢å¤–æ‰§è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> -rf /etc/kubernetes</span><br></pre></td></tr></table></figure>



<h2 id="ä»èŠ‚ç‚¹åŠ å…¥æç¤ºèŠ‚ç‚¹å·²å‡ºç°"><a href="#ä»èŠ‚ç‚¹åŠ å…¥æç¤ºèŠ‚ç‚¹å·²å‡ºç°" class="headerlink" title="ä»èŠ‚ç‚¹åŠ å…¥æç¤ºèŠ‚ç‚¹å·²å‡ºç°"></a>ä»èŠ‚ç‚¹åŠ å…¥æç¤ºèŠ‚ç‚¹å·²å‡ºç°</h2><p>é—®é¢˜ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[preflight] FYI: You can look at this config file with <span class="string">&#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;</span></span><br><span class="line">error execution phase kubelet-start: a Node with name <span class="string">&quot;lab2&quot;</span> and status <span class="string">&quot;Ready&quot;</span> already exists <span class="keyword">in</span> the cluster. You must delete the existing Node or change the name of this new joining Node</span><br><span class="line">To see the stack trace of this error execute with --v=5 or higher</span><br></pre></td></tr></table></figure>



<p>æ–¹æ³•ï¼ˆä¸»èŠ‚ç‚¹ï¼‰</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete node lab2</span><br></pre></td></tr></table></figure>

<p>ç„¶åä»èŠ‚ç‚¹é‡æ–°åŠ å…¥</p>
<h2 id="flanneléƒ¨ç½²å‡ºé”™åˆ é™¤é…ç½®"><a href="#flanneléƒ¨ç½²å‡ºé”™åˆ é™¤é…ç½®" class="headerlink" title="flanneléƒ¨ç½²å‡ºé”™åˆ é™¤é…ç½®"></a>flanneléƒ¨ç½²å‡ºé”™åˆ é™¤é…ç½®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@lab2 ~]# kubectl delete -f /opt/yaml/kube-flannel.yaml</span><br><span class="line">namespace <span class="string">&quot;kube-flannel&quot;</span> deleted</span><br><span class="line">clusterrole.rbac.authorization.k8s.io <span class="string">&quot;flannel&quot;</span> deleted</span><br><span class="line">clusterrolebinding.rbac.authorization.k8s.io <span class="string">&quot;flannel&quot;</span> deleted</span><br><span class="line">serviceaccount <span class="string">&quot;flannel&quot;</span> deleted</span><br><span class="line">configmap <span class="string">&quot;kube-flannel-cfg&quot;</span> deleted</span><br><span class="line">daemonset.apps <span class="string">&quot;kube-flannel-ds&quot;</span> deleted</span><br></pre></td></tr></table></figure>



<h2 id="åˆ é™¤æµ‹è¯•æ—¶åˆ›å»ºçš„nginxæœåŠ¡"><a href="#åˆ é™¤æµ‹è¯•æ—¶åˆ›å»ºçš„nginxæœåŠ¡" class="headerlink" title="åˆ é™¤æµ‹è¯•æ—¶åˆ›å»ºçš„nginxæœåŠ¡"></a>åˆ é™¤æµ‹è¯•æ—¶åˆ›å»ºçš„nginxæœåŠ¡</h2><p>åˆ é™¤ Deployment å’Œ Pod</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete deployment nginx</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤å¯¹åº”çš„ Service</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete svc nginx</span><br></pre></td></tr></table></figure>

<p>ç¡®è®¤èµ„æºå·²è¢«åˆ é™¤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pod,svc</span><br></pre></td></tr></table></figure>



<h2 id="è¿‡ç¨‹ä¸­çš„k8så‘½ä»¤-ä»èŠ‚ç‚¹é…ç½®kubectl"><a href="#è¿‡ç¨‹ä¸­çš„k8så‘½ä»¤-ä»èŠ‚ç‚¹é…ç½®kubectl" class="headerlink" title="è¿‡ç¨‹ä¸­çš„k8så‘½ä»¤&amp;&amp;ä»èŠ‚ç‚¹é…ç½®kubectl"></a>è¿‡ç¨‹ä¸­çš„k8så‘½ä»¤&amp;&amp;ä»èŠ‚ç‚¹é…ç½®kubectl</h2><p><code>kubelet</code>ï¼šåœ¨ <strong>æ¯ä¸ªèŠ‚ç‚¹</strong> ä¸Šè¿è¡Œï¼Œè´Ÿè´£ç®¡ç†èŠ‚ç‚¹ä¸Šçš„å®¹å™¨å’Œ Podã€‚</p>
<p><code>kubeadm</code>ï¼šåœ¨ <strong>ä¸»èŠ‚ç‚¹</strong> ä¸Šç”¨äºåˆå§‹åŒ–é›†ç¾¤ï¼Œåœ¨ <strong>ä»èŠ‚ç‚¹</strong> ä¸Šç”¨äºåŠ å…¥é›†ç¾¤ã€‚</p>
<p><code>kubectl</code>ï¼šåœ¨ <strong>ä»»æ„èŠ‚ç‚¹</strong> ä¸Šè¿è¡Œï¼Œç”¨äºæ“ä½œå’Œç®¡ç†é›†ç¾¤ã€‚</p>
<p>ä¸Šè¿°è¿‡ç¨‹ä¸­<code>kubectl</code>åªéƒ¨ç½²åœ¨äº†ä¸»èŠ‚ç‚¹ä¸Šï¼Œä»èŠ‚ç‚¹è°ƒç”¨ç›¸å…³æŒ‡ä»¤æœ‰å¦‚ä¸‹é”™è¯¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@lab2 ~]# kubectl apply -f /opt/yaml/kube-flannel.yaml</span><br><span class="line">The connection to the server localhost:8080 was refused - did you specify the right host or port?</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³åœ¨ä»èŠ‚ç‚¹æ‰§è¡Œè¿™äº›æŒ‡ä»¤æ—¶ï¼Œç”¨ä¸äº†ï¼Œå¯ä»¥å¤åˆ¶ä¸»èŠ‚ç‚¹çš„é…ç½®å³å¯</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f /opt/yaml/kube-flannel.yaml</span><br><span class="line">kubectl get nodes</span><br><span class="line">kubectl get pods -n kube-flannel</span><br></pre></td></tr></table></figure>

<p>å…·ä½“æ“ä½œ</p>
<p>æŸ¥çœ‹ä»èŠ‚ç‚¹é…ç½®ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@lab2 ~]# <span class="built_in">ls</span> ~/.kube/config</span><br><span class="line"><span class="built_in">ls</span>: æ— æ³•è®¿é—® <span class="string">&#x27;/root/.kube/config&#x27;</span>: No such file or directory</span><br></pre></td></tr></table></figure>



<p>æ²¡æœ‰æ‰¾åˆ° ~&#x2F;.kube&#x2F;config æ–‡ä»¶ï¼Œè¯´æ˜ kubectl é…ç½®æ–‡ä»¶è¿˜æ²¡æœ‰æ­£ç¡®è®¾ç½®ã€‚</p>
<p>è§£å†³æ­¥éª¤ï¼š<br>åœ¨ä¸»èŠ‚ç‚¹ä¸Šè·å– kubeconfig æ–‡ä»¶ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">cat</span> /etc/kubernetes/admin.conf</span><br></pre></td></tr></table></figure>

<p>å¤åˆ¶é…ç½®æ–‡ä»¶åˆ°å·¥ä½œèŠ‚ç‚¹</p>
<p>å°†è¾“å‡ºçš„é…ç½®æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°å·¥ä½œèŠ‚ç‚¹ä¸Šçš„ ~&#x2F;.kube&#x2F;config æ–‡ä»¶</p>
<p>æ²¡æœ‰åˆ™æ–°å»º</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@lab2 ~]# <span class="built_in">mkdir</span> -p ~/.kube</span><br><span class="line">[root@lab2 ~]# nano ~/.kube/config</span><br></pre></td></tr></table></figure>

<p>ç„¶åå°±å¥½äº†</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@lab2 ~]# kubectl get nodes</span><br><span class="line">NAME   STATUS   ROLES                  AGE   VERSION</span><br><span class="line">lab0   Ready    control-plane,master   32h   v1.20.2</span><br><span class="line">lab2   Ready    &lt;none&gt;                 18m   v1.20.2</span><br><span class="line">lab3   Ready    &lt;none&gt;                 27m   v1.20.2</span><br></pre></td></tr></table></figure>











<h1 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h1><p><a target="_blank" rel="noopener" href="https://docs.openeuler.org/zh/docs/22.03_LTS_SP3/docs/ClusterDeployment/K8s+iSulad%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2.html">K8s+iSuladç¯å¢ƒéƒ¨ç½² | openEuleræ–‡æ¡£ | openEulerç¤¾åŒº | v22.03_LTS_SP3</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/BY_imba/article/details/128490582">openEuler éƒ¨ç½²Kubernetesï¼ˆK8sï¼‰é›†ç¾¤_ã€Šopeneuler kubernetes é›†ç¾¤éƒ¨ç½²æŒ‡å—ã€‹-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.openeuler.org/zh/docs/22.03_LTS_SP3/docs/ClusterDeployment/K8s+iSulad%E7%8E%AF%E5%A2%83%E9%83%A8%E7%BD%B2.html">K8s+iSuladç¯å¢ƒéƒ¨ç½² | openEuleræ–‡æ¡£ | openEulerç¤¾åŒº | v22.03_LTS_SP3</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Lichen0196/article/details/137355517">dockerå›½å†…é•œåƒæºé…ç½®åŠèµ°ä»£ç†è®¾ç½®_dockeré•œåƒä»£ç†-CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_33326449/article/details/119699126">It seems like the kubelet isnâ€˜t running or healthy_it seems like the kubelet isnâ€™t running or healthy-CSDNåšå®¢</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/27/openEuler-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="FlareBall">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlareBall's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/11/27/openEuler-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">è™šæ‹Ÿæœºå®‰è£…openEuler22.03 SP3</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-11-27 00:10:00 / Modified: 00:11:58" itemprop="dateCreated datePublished" datetime="2024-11-27T00:10:00+08:00">2024-11-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="è™šæ‹Ÿæœºå®‰è£…openEuler22-03-SP3"><a href="#è™šæ‹Ÿæœºå®‰è£…openEuler22-03-SP3" class="headerlink" title="è™šæ‹Ÿæœºå®‰è£…openEuler22.03 SP3"></a>è™šæ‹Ÿæœºå®‰è£…openEuler22.03 SP3</h1><p>ç¯å¢ƒï¼šWin11 VMware Workstation 16.02</p>
<h2 id="æ­¥éª¤-VMware-Workstation-16-02"><a href="#æ­¥éª¤-VMware-Workstation-16-02" class="headerlink" title="æ­¥éª¤(VMware Workstation 16.02)"></a>æ­¥éª¤(VMware Workstation 16.02)</h2><ol>
<li><p>é€‰æ‹©è‡ªå®šä¹‰</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124222149059.png" alt="image-20241124222149059"></p>
</li>
<li><p>ä¿æŒä¸å˜</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124222233414.png" alt="image-20241124222233414"></p>
</li>
<li><p>ç¨åå®‰è£…æ“ä½œç³»ç»Ÿ</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124222305170.png" alt="image-20241124222305170"></p>
</li>
<li><p>è¿™é‡Œç¬”è€…é€‰æ‹©çš„Linux Centos 7 64ä½</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124222910568.png" alt="image-20241124222910568"></p>
</li>
<li><p>è‡ªå®šä¹‰åç§°å’Œè·¯å¾„</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124223034266.png" alt="image-20241124223034266"></p>
</li>
<li><p>è‡ªå®šä¹‰å¤„ç†å™¨ä¿¡æ¯ã€‚ç¬”è€…æŒ‡å®šäº†2ä¸ªå¤„ç†å™¨ï¼Œæ¯ä¸ªå¤„ç†å™¨2ä¸ªå†…æ ¸</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124223147374.png" alt="image-20241124223147374"></p>
</li>
<li><p>è‡ªå®šä¹‰å†…å­˜ï¼Œç¬”è€…æŒ‡å®š4GB</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124223258483.png" alt="image-20241124223258483"></p>
</li>
<li><p>è‡ªå®šä¹‰ç½‘ç»œè¿æ¥æ–¹å¼ã€‚ç¬”è€…ä½¿ç”¨äº†NATæ–¹å¼ï¼Œå¯ä»¥ç†è§£ä¸ºåœ¨å®¿ä¸»æœºæ–°å»ºä¸€å¼ è™šæ‹Ÿç½‘å¡ï¼Œç„¶åæŠŠè™šæ‹Ÿæœºåˆ†é…åˆ°å…¶å­ç½‘ä¸­</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124223543570.png" alt="image-20241124223543570"></p>
</li>
<li><p>ä¿æŒä¸å˜</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124223615058.png" alt="image-20241124223615058"></p>
</li>
<li><p>ä¿æŒä¸å˜</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124223657315.png" alt="image-20241124223657315"></p>
</li>
<li><p>ä¿æŒä¸å˜</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124223716195.png" alt="image-20241124223716195"></p>
</li>
<li><p>è‡ªå®šä¹‰ç£ç›˜å¤§å°ï¼Œç¬”è€…åˆ†é…äº†40GBï¼Œå­˜å‚¨ä¸ºå•ä¸ªæ–‡ä»¶</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124223810234.png" alt="image-20241124223810234"></p>
</li>
<li><p>è‡ªå®šä¹‰è™šæ‹Ÿç£ç›˜è·¯å¾„</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124223847768.png" alt="image-20241124223847768"></p>
</li>
<li><p>æŒ‡å®šè™šæ‹ŸDVD</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124223930262.png" alt="image-20241124223930262"></p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124224102970.png" alt="image-20241124224102970"></p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124224121061.png" alt="image-20241124224121061"></p>
</li>
</ol>
<h2 id="æ­¥éª¤-è™šæ‹Ÿæœºåˆå§‹åŒ–"><a href="#æ­¥éª¤-è™šæ‹Ÿæœºåˆå§‹åŒ–" class="headerlink" title="æ­¥éª¤(è™šæ‹Ÿæœºåˆå§‹åŒ–)"></a>æ­¥éª¤(è™šæ‹Ÿæœºåˆå§‹åŒ–)</h2><p>Enter&#x2F;ç­‰å¾…60s å¼€å§‹å®‰è£…ï¼Œç£ç›˜æ£€æŸ¥å¤§æ¦‚è¦å‡ åˆ†é’Ÿï¼Œè¿›å…¥å®‰è£…ç•Œé¢</p>
<ol>
<li><p>å®‰è£…è¿‡ç¨‹ä½¿ç”¨ä¸­æ–‡</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124230017053.png" alt="image-20241124230017053"></p>
</li>
<li><p>å®‰è£…ç›®çš„åœ°é€‰æ‹©ï¼Œç‚¹è¿›å»é€€å‡ºæ¥å°±å¯ä»¥</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124230120638.png" alt="image-20241124230120638"></p>
</li>
<li><p>è¯­è¨€æ”¯æŒæ·»åŠ è‹±è¯­</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124230218313.png" alt="image-20241124230218313"></p>
</li>
<li><p>ç½‘ç»œé“¾æ¥ï¼Œè®¾ç½®ä¸»æœºå</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124230305786.png" alt="image-20241124230305786"></p>
</li>
<li><p>è®¾ç½®rootç”¨æˆ·</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124230447725.png" alt="image-20241124230447725"></p>
</li>
<li><p>å¼€å§‹å®‰è£…&amp;é‡å¯ç³»ç»Ÿï¼Œå‡ºç°å¦‚ä¸‹ç•Œé¢å®‰è£…å®Œæˆ</p>
<p><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/image-20241124232613735.png" alt="image-20241124232613735"></p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/17/Linux%E6%89%A9%E5%B1%95%E7%A9%BA%E9%97%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="FlareBall">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlareBall's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/17/Linux%E6%89%A9%E5%B1%95%E7%A9%BA%E9%97%B4/" class="post-title-link" itemprop="url">å¦‚ä½•åœ¨linuxä¸Šç»™ç£ç›˜æ‰©å®¹</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-10-17 01:20:00" itemprop="dateCreated datePublished" datetime="2024-10-17T01:20:00+08:00">2024-10-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-27 00:10:29" itemprop="dateModified" datetime="2024-11-27T00:10:29+08:00">2024-11-27</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>åœ¨æ­å»ºk8sé›†ç¾¤æ—¶é‡åˆ°äº†éœ€è¦ç»™ç£ç›˜æ‰©å®¹çš„æƒ…å†µï¼Œå†™ä¸€ç¯‡æ–‡ç« è®°å½•è‡ªå·±çš„ç»å†</p>
<p>èƒŒæ™¯çŸ¥è¯†ï¼š<br>LVMï¼ˆLogical Volume Managerï¼Œé€»è¾‘å·ç®¡ç†å™¨ï¼‰æ˜¯ Linux æ“ä½œç³»ç»Ÿä¸­çš„ä¸€ç§çµæ´»çš„ç£ç›˜ç®¡ç†å·¥å…·ï¼Œå®ƒé€šè¿‡å°†å¤šä¸ªç‰©ç†ç¡¬ç›˜æˆ–åˆ†åŒºç»„åˆæˆä¸€ä¸ªæˆ–å¤šä¸ªé€»è¾‘å·ï¼Œæä¾›æ¯”ä¼ ç»Ÿåˆ†åŒºç®¡ç†æ›´å¼ºå¤§çš„å­˜å‚¨ç®¡ç†åŠŸèƒ½ã€‚LVM å…è®¸åŠ¨æ€è°ƒæ•´å­˜å‚¨ç©ºé—´å¤§å°ã€è·¨å¤šä¸ªç‰©ç†ç£ç›˜åˆ›å»ºé€»è¾‘å·ï¼Œå¹¶æ”¯æŒå¿«ç…§ã€é•œåƒç­‰é«˜çº§åŠŸèƒ½ã€‚</p>
<h2 id="1-æŸ¥çœ‹å·²è¿æ¥ç³»ç»Ÿçš„ç¡¬ç›˜åŠå…¶åˆ†åŒº"><a href="#1-æŸ¥çœ‹å·²è¿æ¥ç³»ç»Ÿçš„ç¡¬ç›˜åŠå…¶åˆ†åŒº" class="headerlink" title="1. æŸ¥çœ‹å·²è¿æ¥ç³»ç»Ÿçš„ç¡¬ç›˜åŠå…¶åˆ†åŒº"></a>1. æŸ¥çœ‹å·²è¿æ¥ç³»ç»Ÿçš„ç¡¬ç›˜åŠå…¶åˆ†åŒº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> fdisk -l</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°å‰é¢æ˜¯è‹¥å¹²å›ç¯è®¾å¤‡ï¼ˆå¦‚loop0ï¼‰çš„ä¿¡æ¯ï¼Œè¿™æ˜¯linuxä¸€ç§è™šæ‹Ÿè®¾å¤‡ï¼Œè€Œ&#x2F;dev&#x2F;sdaæ˜¯ç‰©ç†ç¡¬ç›˜ã€‚&#x2F;dev&#x2F;sda1, &#x2F;dev&#x2F;sda2, &#x2F;dev&#x2F;sda3ï¼šè¡¨ç¤ºè¯¥ç¡¬ç›˜çš„ä¸åŒåˆ†åŒºã€‚æœ€åæ˜¯ç”± LVMï¼ˆé€»è¾‘å·ç®¡ç†å™¨ï¼‰ ç®¡ç†çš„åˆ†åŒº&#x2F;dev&#x2F;mapper&#x2F;ubuntuâ€“vg-ubuntuâ€“lv<br><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/fdisk.png" alt="æŸ¥çœ‹å·²è¿æ¥ç³»ç»Ÿçš„ç¡¬ç›˜åŠå…¶åˆ†åŒº"></p>
<h2 id="2-æŸ¥çœ‹ç£ç›˜çš„ä½¿ç”¨æƒ…å†µ"><a href="#2-æŸ¥çœ‹ç£ç›˜çš„ä½¿ç”¨æƒ…å†µ" class="headerlink" title="2. æŸ¥çœ‹ç£ç›˜çš„ä½¿ç”¨æƒ…å†µ"></a>2. æŸ¥çœ‹ç£ç›˜çš„ä½¿ç”¨æƒ…å†µ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œ df -h æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿçš„å½“å‰ä½¿ç”¨æƒ…å†µï¼Œudev æ˜¯ Linux å†…æ ¸æä¾›çš„è®¾å¤‡ç®¡ç†å™¨ï¼Œtmpfs æ˜¯åŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œé€šå¸¸ç”¨äºå­˜å‚¨ä¸´æ—¶æ–‡ä»¶ã€‚å¯ä»¥çœ‹åˆ°ç³»ç»Ÿçš„æ ¹åˆ†åŒº&#x2F;ç›®å‰ä¸º 98GBï¼Œä½¿ç”¨äº† 6.8GBï¼Œå‰©ä½™ 87GBã€‚æ ¹ç›®å½•æŒ‚åœ¨&#x2F;dev&#x2F;mapper&#x2F;ubuntuâ€“vg-ubuntuâ€“lv<br><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/df-h.png" alt="æŸ¥çœ‹ç£ç›˜çš„ä½¿ç”¨æƒ…å†µ"></p>
<h2 id="3-æŸ¥çœ‹å—è®¾å¤‡ä¿¡æ¯"><a href="#3-æŸ¥çœ‹å—è®¾å¤‡ä¿¡æ¯" class="headerlink" title="3. æŸ¥çœ‹å—è®¾å¤‡ä¿¡æ¯"></a>3. æŸ¥çœ‹å—è®¾å¤‡ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsblk</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œ lsblk å¯ä»¥æŸ¥çœ‹å—è®¾å¤‡çš„æŒ‚è½½ç‚¹åŠåˆ†åŒºã€‚å¯ä»¥çœ‹åˆ° &#x2F;dev&#x2F;sda3 è¢«åˆ†é…åˆ°äº† ubuntuâ€“vg-ubuntuâ€“lv é€»è¾‘å·ï¼Œå¤§å°ä¸º 100GB<br><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/lsblk.png" alt="çœ‹å—è®¾å¤‡ä¿¡æ¯"></p>
<h2 id="4-æŸ¥çœ‹LVMä¸­å·ç»„ä¿¡æ¯"><a href="#4-æŸ¥çœ‹LVMä¸­å·ç»„ä¿¡æ¯" class="headerlink" title="4. æŸ¥çœ‹LVMä¸­å·ç»„ä¿¡æ¯"></a>4. æŸ¥çœ‹LVMä¸­å·ç»„ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> vgdisplay</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œ vgdisplay æŸ¥çœ‹å½“å‰å·ç»„çš„è¯¦ç»†ä¿¡æ¯ã€‚å¯ä»¥çœ‹åˆ° ubuntu-vg å·ç»„çš„æ€»å¤§å°ä¸º 1.82TBï¼Œå…¶ä¸­ 100GB å·²è¢«åˆ†é…ç»™ç°æœ‰çš„é€»è¾‘å·ï¼Œè¿˜å‰© 1.72TB å¯ç”¨äºæ‰©å±•<br><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/vgdisplay.png" alt="çœ‹LVMä¸­å·ç»„ä¿¡æ¯"></p>
<h2 id="5-æ‰©å±•é€»è¾‘å·"><a href="#5-æ‰©å±•é€»è¾‘å·" class="headerlink" title="5. æ‰©å±•é€»è¾‘å·"></a>5. æ‰©å±•é€»è¾‘å·</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> lvextend -l +200G /dev/mapper/ubuntu--vg-ubuntu--lv</span><br></pre></td></tr></table></figure>
<p>å°†é€»è¾‘å· ubuntu-lv çš„å¤§å°å¢åŠ  200 GBï¼Œ-lï¼šè¡¨ç¤ºæ ¹æ®æ‰©å±•å•ä½ â€œPEï¼ˆPhysical Extentsï¼‰â€ æ¥æ‰©å±•ç©ºé—´ã€‚+200Gï¼šè¡¨ç¤ºå°†é€»è¾‘å·å¢åŠ  200 GB çš„å®¹é‡ï¼Œ&#x2F;dev&#x2F;mapper&#x2F;ubuntuâ€“vg-ubuntuâ€“lvï¼šæ˜¯ç›®æ ‡é€»è¾‘å·çš„è·¯å¾„ï¼Œè¡¨ç¤ºè¦æ‰©å±•çš„é€»è¾‘å·åœ¨ ubuntu-vg å·ç»„ä¸­çš„ ubuntu-lv<br><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/lvextend.png" alt="æ‰©å±•é€»è¾‘å·"></p>
<h2 id="6-è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°"><a href="#6-è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°" class="headerlink" title="6. è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°"></a>6. è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv</span><br></pre></td></tr></table></figure>
<p>æ‰©å±•é€»è¾‘å·åï¼Œéœ€è¦è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿçš„å¤§å°ä»¥ä½¿ç”¨æ–°åˆ†é…çš„ç©ºé—´ã€‚ä½¿ç”¨ LVM æ‰©å±•é€»è¾‘å·æ—¶ï¼Œæ–‡ä»¶ç³»ç»Ÿä¸ä¼šè‡ªåŠ¨æ‰©å±•ï¼Œæ–‡ä»¶ç³»ç»Ÿæ‰©å±•æ˜¯å¿…éœ€çš„<br><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/resize2fs.png" alt="è°ƒæ•´æ–‡ä»¶ç³»ç»Ÿå¤§å°"></p>
<h2 id="7-æŸ¥çœ‹æ‰©å®¹ç»“æœ"><a href="#7-æŸ¥çœ‹æ‰©å®¹ç»“æœ" class="headerlink" title="7. æŸ¥çœ‹æ‰©å®¹ç»“æœ"></a>7. æŸ¥çœ‹æ‰©å®¹ç»“æœ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ° &#x2F;dev&#x2F;mapper&#x2F;ubuntuâ€“vg-ubuntuâ€“lv çš„æ€»å¤§å°å·²æˆåŠŸæ‰©å±•<br><img src="https://raw.githubusercontent.com/dddegithub/PicGo/main/df-h-2.png" alt="æŸ¥çœ‹æ‰©å®¹ç»“æœ"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/15/114514/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="FlareBall">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FlareBall's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/15/114514/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-10-15 00:15:09 / Modified: 00:40:00" itemprop="dateCreated datePublished" datetime="2024-10-15T00:15:09+08:00">2024-10-15</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>114514</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">FlareBall</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FlareBall</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
